<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sanctuary Quran | Ramadan Edition</title>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=Amiri+Quran:wght@400&family=Lateef:wght@400;700&family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --primary: #10b981;
      --secondary: #059669;
      --accent: #fbbf24;
      --bg-dark: #05070a;
      --text-primary: #f1f5f9;
      --text-secondary: #94a3b8;
      --border-color: rgba(255, 255, 255, 0.08);
      --card-bg: rgba(255, 255, 255, 0.03);
      --radius: 20px;
      --arabic-size: 2.8rem;
    }

    body.ramadan-mode {
      --primary: #fbbf24;
      --secondary: #d97706;
      --bg-dark: #020617;
      background-image: radial-gradient(circle at 50% 0%, #1e1b4b 0%, #020617 100%);
    }

    * { box-sizing: border-box; transition: all 0.25s ease; }
    
    body { 
        margin: 0; font-family: 'Plus Jakarta Sans', sans-serif; 
        background: var(--bg-dark); color: var(--text-primary); 
        height: 100vh; overflow: hidden; display: flex; flex-direction: column;
    }

    /* NAVIGATION */
    header { height: 70px; display: flex; align-items: center; justify-content: space-between; padding: 0 30px; border-bottom: 1px solid var(--border-color); background: rgba(0,0,0,0.2); backdrop-filter: blur(10px); z-index: 100; }
    .logo { font-family: 'Playfair Display', serif; font-size: 1.3rem; font-weight: 700; color: var(--primary); display: flex; align-items: center; gap: 8px; }
    
    .nav-actions { display: flex; align-items: center; gap: 15px; }
    .icon-btn { background: var(--card-bg); border: 1px solid var(--border-color); color: var(--text-primary); width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
    .icon-btn:hover { border-color: var(--primary); color: var(--primary); }

    /* MAIN CONTAINER */
    main { display: grid; grid-template-columns: 1fr 360px; flex: 1; overflow: hidden; }
    
    .content-viewport { overflow-y: auto; padding: 30px 50px; scrollbar-width: none; }
    .content-viewport::-webkit-scrollbar { width: 0; }
    
    /* SEARCH & GRID */
    .search-wrapper { margin-bottom: 40px; position: relative; max-width: 600px; }
    #surahSearch { width: 100%; padding: 15px 25px; border-radius: 15px; background: var(--card-bg); border: 1px solid var(--border-color); color: white; font-size: 1rem; }

    .surah-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 15px; }
    .card { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: var(--radius); padding: 20px; cursor: pointer; position: relative; }
    .card:hover { border-color: var(--primary); background: rgba(255,255,255,0.05); transform: scale(1.02); }
    .card h3 { margin: 0; font-size: 1.1rem; }
    .card p { margin: 4px 0 0; font-size: 0.75rem; color: var(--text-secondary); letter-spacing: 0.5px; }

    /* READER VIEW */
    .reader-view { display: none; max-width: 800px; margin: 0 auto; }
    .reader-view.active { display: block; animation: fadeIn 0.4s ease; }
    .ayah-block { margin-bottom: 50px; padding-bottom: 30px; border-bottom: 1px solid rgba(255,255,255,0.03); }
    .q-text { font-family: 'Amiri Quran', serif; font-size: var(--arabic-size); text-align: right; line-height: 2.2; direction: rtl; margin-bottom: 15px; }
    .q-trans { text-align: left; font-size: 1.05rem; color: var(--text-secondary); line-height: 1.7; font-weight: 400; }

    /* SIDEBAR (SENTINEL) */
    aside.sentinel { border-left: 1px solid var(--border-color); background: rgba(0,0,0,0.15); padding: 25px; display: flex; flex-direction: column; gap: 20px; }
    .tab-nav { display: flex; background: rgba(0,0,0,0.3); padding: 5px; border-radius: 12px; }
    .tab-btn { flex: 1; background: none; border: none; padding: 10px; color: var(--text-secondary); cursor: pointer; font-size: 0.7rem; font-weight: 700; border-radius: 8px; display: flex; flex-direction: column; align-items: center; gap: 5px; }
    .tab-btn.active { background: var(--primary); color: var(--bg-dark); }

    .insight-card { background: var(--card-bg); border: 1px solid var(--border-color); padding: 20px; border-radius: 15px; line-height: 1.6; font-size: 0.9rem; }

    /* SETTINGS PANEL */
    #settings-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); z-index: 200; display: none; align-items: center; justify-content: center; }
    .settings-modal { background: var(--bg-dark); border: 1px solid var(--border-color); padding: 30px; border-radius: 25px; width: 350px; display: flex; flex-direction: column; gap: 20px; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* RAMADAN SPECIFIC */
    .ramadan-badge { color: var(--accent); font-size: 0.7rem; font-weight: 800; border: 1px solid var(--accent); padding: 2px 8px; border-radius: 5px; margin-left: 10px; }
  </style>
</head>
<body class="ramadan-mode">

  <header>
    <div class="logo"><i data-lucide="moon"></i> SANCTUARY <span class="ramadan-badge">RAMADAN</span></div>
    <div class="nav-actions">
        <div style="font-size: 0.8rem; color: var(--accent); margin-right: 15px;">
            <i data-lucide="zap" size="14" style="vertical-align: middle;"></i> <span id="xp-display">0</span> XP
        </div>
        <button class="icon-btn" onclick="toggleSettings()"><i data-lucide="settings"></i></button>
    </div>
  </header>

  <main>
    <div class="content-viewport" id="scroll-root">
      <div id="home-view">
        <div class="search-wrapper">
            <input type="text" id="surahSearch" placeholder="Search Surah or Number..." oninput="App.filter(this.value)">
        </div>
        <div id="grid-container" class="surah-grid"></div>
      </div>

      <div id="reader-view" class="reader-view">
        <button onclick="closeReader()" style="background:none; border:none; color:var(--primary); cursor:pointer; margin-bottom:30px; display:flex; align-items:center; gap:8px; font-weight:700;">
            <i data-lucide="chevron-left"></i> RETURN TO JOURNEY
        </button>
        <div id="reader-content"></div>
      </div>
    </div>

    <aside class="sentinel">
      <div class="tab-nav">
        <button class="tab-btn active" onclick="switchTab('tafsir', this)"><i data-lucide="book-open" size="18"></i>TAFSIR</button>
        <button class="tab-btn" onclick="switchTab('lessons', this)"><i data-lucide="graduation-cap" size="18"></i>LESSONS</button>
        <button class="tab-btn" onclick="switchTab('hadith', this)"><i data-lucide="scroll" size="18"></i>HADITH</button>
      </div>
      <div id="ai-output" class="insight-card">
        <div style="text-align: center; opacity: 0.5; padding: 20px;">
            <i data-lucide="fingerprint" size="40"></i><br><br>
            Select a verse to analyze divine signatures.
        </div>
      </div>
    </aside>
  </main>

  <div id="settings-overlay" onclick="toggleSettings()">
    <div class="settings-modal" onclick="event.stopPropagation()">
        <h2 style="margin:0 0 10px 0; font-family: Playfair Display;">Settings</h2>
        <label style="font-size:0.8rem; opacity:0.7;">Arabic Font Size</label>
        <input type="range" min="1.5" max="5" step="0.1" value="2.8" oninput="updateFontSize(this.value)">
        
        <label style="font-size:0.8rem; opacity:0.7;">Ramadan Focus Mode</label>
        <button class="icon-btn" style="width:100%" onclick="toggleRamadan()">Toggle Atmosphere</button>
        
        <button class="icon-btn" style="width:100%; margin-top:10px; background:var(--primary); color:black;" onclick="toggleSettings()">Save & Close</button>
    </div>
  </div>

  <script>
    const App = {
      state: {
        chapters: [],
        currentTab: 'tafsir',
        currentVerse: null,
        xp: parseInt(localStorage.getItem('sanct-xp')) || 0
      },

      async init() {
        lucide.createIcons();
        this.updateXP(0);
        const res = await fetch('https://api.alquran.cloud/v1/surah');
        const json = await res.json();
        this.state.chapters = json.data;
        this.renderGrid(this.state.chapters);
      },

      renderGrid(list) {
        document.getElementById('grid-container').innerHTML = list.map(s => `
          <div class="card" onclick="loadSurah(${s.number})">
            <p>SURAH ${s.number}</p>
            <h3>${s.englishName}</h3>
            <p style="color:var(--primary)">${s.numberOfAyahs} Ayahs â€¢ ${s.revelationType}</p>
          </div>
        `).join('');
      },

      filter(q) {
        const filtered = this.state.chapters.filter(c => 
          c.englishName.toLowerCase().includes(q.toLowerCase()) || c.number == q
        );
        this.renderGrid(filtered);
      },

      updateXP(val) {
        this.state.xp += val;
        document.getElementById('xp-display').innerText = this.state.xp;
        localStorage.setItem('sanct-xp', this.state.xp);
      }
    };

    async function loadSurah(id) {
        document.getElementById('home-view').style.display = 'none';
        const reader = document.getElementById('reader-view');
        const content = document.getElementById('reader-content');
        reader.classList.add('active');
        content.innerHTML = `<div style="padding:50px; text-align:center;">Opening Divine Gateway...</div>`;
        document.getElementById('scroll-root').scrollTop = 0;

        try {
            const [ar, en] = await Promise.all([
                fetch(`https://api.alquran.cloud/v1/surah/${id}`).then(r => r.json()),
                fetch(`https://api.alquran.cloud/v1/surah/${id}/en.sahih`).then(r => r.json())
            ]);

            let html = `<h1 style="text-align:center; font-family:'Amiri Quran'; font-size:3.5rem; color:var(--primary); margin-bottom:50px;">${ar.data.name}</h1>`;
            
            html += ar.data.ayahs.map((ayah, i) => `
                <div class="ayah-block" onclick="getInsight(${id}, ${ayah.numberInSurah})">
                    <div class="q-text">${ayah.text}</div>
                    <div class="q-trans">${en.data.ayahs[i].text}</div>
                    <div style="font-size:0.7rem; color:var(--primary); margin-top:10px; font-family:IBM Plex Mono">VERSE ${id}:${ayah.numberInSurah}</div>
                </div>
            `).join('');

            content.innerHTML = html;
            App.updateXP(10);
        } catch (e) { content.innerHTML = "Error loading surah."; }
    }

    function switchTab(tab, el) {
        App.state.currentTab = tab;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        if(App.state.currentVerse) getInsight(...App.state.currentVerse);
    }

    function getInsight(s, a) {
        App.state.currentVerse = [s, a];
        const output = document.getElementById('ai-output');
        const tab = App.state.currentTab;
        
        const insights = {
            tafsir: [
                "This verse focuses on the architectural balance of creation and the responsibilities of man.",
                "Classical commentators suggest this verse was revealed to provide comfort during times of trial.",
                "Linguistically, the root word here implies a Mercy that is both vast and immediate."
            ],
            lessons: [
                "Patience (Sabr) is not just waiting, but how we behave while we wait.",
                "Gratitude for small blessings unlocks the doors to greater ones.",
                "Action without intention is like a body without a soul."
            ],
            hadith: [
                "The Prophet (PBUH) said: 'The best of you are those who learn the Quran and teach it.'",
                "Related in Sahih Bukhari: Every action is judged by its intention.",
                "In a Hadith Qudsi, Allah says: 'I am as my servant thinks I am.'"
            ]
        };

        const randomText = insights[tab][(s + a) % 3];
        output.innerHTML = `<b style="color:var(--primary); text-transform:uppercase;">${tab} Insight</b><br><br>${randomText}`;
        App.updateXP(2);
    }

    function closeReader() {
        document.getElementById('home-view').style.display = 'block';
        document.getElementById('reader-view').classList.remove('active');
    }

    function toggleSettings() {
        const modal = document.getElementById('settings-overlay');
        modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
    }

    function updateFontSize(val) {
        document.documentElement.style.setProperty('--arabic-size', val + 'rem');
    }

    function toggleRamadan() {
        document.body.classList.toggle('ramadan-mode');
    }

    window.onload = () => App.init();
  </script>
</body>
</html>
