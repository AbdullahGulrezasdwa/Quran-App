<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sovereign V8 | Final Engine</title>

<script src="https://unpkg.com/lucide@latest"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">

<style>
:root {
    --gold: #fbbf24;
    --bg: #050505;
    --border: rgba(251,191,36,0.1);
    --card: rgba(255,255,255,0.03);
}

*{box-sizing:border-box}
body{
    margin:0;
    font-family:'Plus Jakarta Sans',sans-serif;
    background:var(--bg);
    color:#e5e7eb;
    height:100vh;
    overflow:hidden;
    display:flex;
}

/* Sidebar */
nav{
    width:80px;
    border-right:1px solid var(--border);
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:30px 0;
    gap:30px;
}
.nav-icon{
    color:#6b7280;
    padding:12px;
    border-radius:12px;
    cursor:pointer;
}
.nav-icon:hover,.nav-icon.active{
    color:var(--gold);
    background:rgba(251,191,36,0.1);
}

/* Main */
main{flex:1;display:flex;flex-direction:column;overflow:hidden}

header{
    height:90px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:0 40px;
    border-bottom:1px solid var(--border);
}

.search-box{
    background:var(--card);
    border:1px solid var(--border);
    padding:12px 20px;
    border-radius:14px;
    width:350px;
    display:flex;
    gap:12px;
}
.search-box input{
    background:transparent;
    border:none;
    outline:none;
    color:white;
    width:100%;
}

#clock{
    color:var(--gold);
    font-family:monospace;
    letter-spacing:2px;
}

/* Layout */
.content{
    display:grid;
    grid-template-columns:1fr 380px;
    flex:1;
    overflow:hidden;
}

.grid{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:20px;
    padding:40px;
    overflow-y:auto;
}

.card{
    background:var(--card);
    border:1px solid var(--border);
    padding:30px;
    border-radius:20px;
    cursor:pointer;
}
.card:hover{
    border-color:var(--gold);
    background:rgba(251,191,36,0.05);
}

#reader{
    padding:40px;
    overflow-y:auto;
    display:none;
}

.q-text{
    font-family:'Amiri';
    font-size:2.6rem;
    text-align:right;
    direction:rtl;
    line-height:2.4;
}

aside{
    border-left:1px solid var(--border);
    padding:30px;
}

.loading{
    opacity:0.5;
    pointer-events:none;
}
.error{
    color:#ef4444;
}
</style>
</head>
<body>

<nav>
    <div class="nav-icon active"><i data-lucide="layout-grid"></i></div>
    <div class="nav-icon" onclick="App.showGrid()"><i data-lucide="book-open"></i></div>
</nav>

<main>
<header>
    <div class="search-box">
        <i data-lucide="search"></i>
        <input placeholder="Search Surah..." oninput="App.filter(this.value)">
    </div>
    <div id="clock"></div>
</header>

<div class="content">
    <section id="grid" class="grid"></section>
    <section id="reader"></section>
    <aside>
        <div id="insight">Select a verse to analyze.</div>
    </aside>
</div>
</main>

<script>
const App = {

state:{chapters:[]},

init(){
    this.clock();
    setInterval(()=>this.clock(),1000);
    this.fetchSurahs();
},

clock(){
    const now=new Date();
    document.getElementById('clock').innerText=
        `[ ${now.toTimeString().split(' ')[0]} ]`;
},

async fetchSurahs(){
    const grid=document.getElementById('grid');
    grid.innerHTML="Loading...";
    try{
        const res=await fetch("https://api.alquran.cloud/v1/surah");
        const json=await res.json();
        this.state.chapters=json.data;
        this.renderGrid(json.data);
    }catch{
        grid.innerHTML="<div class='error'>Failed to load Surahs.</div>";
    }
},

renderGrid(list){
    const grid=document.getElementById('grid');
    grid.innerHTML=list.map(s=>`
        <div class="card" onclick="App.loadSurah(${s.number})">
            <h3>${s.englishName}</h3>
            <span>${s.numberOfAyahs} verses</span>
        </div>
    `).join('');
    lucide.createIcons();
},

showGrid(){
    document.getElementById('reader').style.display="none";
    document.getElementById('grid').style.display="grid";
},

async loadSurah(id){
    const reader=document.getElementById('reader');
    const grid=document.getElementById('grid');

    grid.style.display="none";
    reader.style.display="block";
    reader.innerHTML="Loading...";
    reader.classList.add("loading");

    try{
        const [ar,en]=await Promise.all([
            fetch(`https://api.alquran.cloud/v1/surah/${id}/quran-tajweed`).then(r=>r.json()),
            fetch(`https://api.alquran.cloud/v1/surah/${id}/en.sahih`).then(r=>r.json())
        ]);

        let html=`<h1 style="color:var(--gold);text-align:center;font-family:Amiri">
            ${ar.data.name}
        </h1><br><br>`;

        ar.data.ayahs.forEach((ayah,i)=>{
            let text=ayah.text;

            // safer Bismillah removal
            if(id!==1 && i===0 && text.startsWith("بِسْمِ")){
                text=text.substring(text.indexOf("ٱلْحَمْد")>0?text.indexOf("ٱلْحَمْد"):text.length);
            }

            html+=`
            <div onclick="App.getInsight(${i+1})" style="margin-bottom:50px;cursor:pointer">
                <div class="q-text">${text}</div>
                <div style="color:#6b7280;margin-top:15px">
                    ${en.data.ayahs[i].text}
                </div>
            </div>`;
        });

        reader.innerHTML=html;
    }catch{
        reader.innerHTML="<div class='error'>Failed to load Surah.</div>";
    }

    reader.classList.remove("loading");
},

filter(q){
    const filtered=this.state.chapters.filter(c=>
        c.englishName.toLowerCase().includes(q.toLowerCase())
    );
    this.renderGrid(filtered);
},

getInsight(num){
    document.getElementById("insight").innerHTML=`
        <b style="color:var(--gold)">Verse ${num} Analysis:</b><br><br>
        This verse contains rhetorical emphasis typical of Meccan revelation
        and reflects deep linguistic structure tied to mercy (Rahma).
    `;
}

};

window.onload=()=>App.init();
</script>

</body>
</html>
