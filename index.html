<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sovereign | Unified Quran Engine</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Inter:wght@300;400;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --p: #10b981; --bg: #020617; --surf: #0f172a; --text: #f8fafc; --sub: #94a3b8; --border: #1e293b; }
        [data-theme="sepia"] { --bg: #f4f1ea; --surf: #e8e4d9; --text: #2d241e; --sub: #5d534a; --border: #d1cdc0; --p: #8b5e3c; }
        [data-theme="light"] { --bg: #ffffff; --surf: #f1f5f9; --text: #0f172a; --sub: #475569; --border: #e2e8f0; --p: #2563eb; }

        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; height: 100vh; overflow: hidden; transition: 0.3s; }
        
        /* Sidebar Navigation */
        nav { width: 70px; background: var(--surf); border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding: 25px 0; gap: 30px; z-index: 100; }
        .nav-btn { color: var(--sub); cursor: pointer; transition: 0.2s; padding: 12px; border-radius: 14px; }
        .nav-btn:hover, .nav-btn.active { color: var(--p); background: rgba(16,185,129,0.1); }

        /* Main Content Area */
        main { flex: 1; overflow-y: auto; scroll-behavior: smooth; position: relative; }
        .container { max-width: 900px; margin: 0 auto; padding: 40px 20px; }

        /* Header */
        header { position: sticky; top: 0; background: var(--bg); padding: 20px 0; border-bottom: 1px solid var(--border); z-index: 50; display: flex; justify-content: space-between; align-items: center; }
        .search-group { display: flex; background: var(--surf); border: 1px solid var(--border); border-radius: 30px; padding: 5px 15px; align-items: center; }
        #search-input { background: none; border: none; color: var(--text); padding: 8px; outline: none; width: 200px; }

        /* Ayah Cards */
        .ayah-card { padding: 50px 0; border-bottom: 1px solid var(--border); position: relative; transition: 0.3s; cursor: pointer; }
        .ayah-card:hover { background: rgba(16,185,129,0.02); }
        .ar { font-family: 'Amiri', serif; font-size: 2.8rem; text-align: right; direction: rtl; line-height: 2.5; margin-bottom: 25px; color: var(--p); }
        .en { font-size: 1.2rem; color: var(--sub); line-height: 1.8; font-weight: 300; }
        .meta-tag { font-size: 0.8rem; color: var(--p); margin-bottom: 10px; opacity: 0.6; font-weight: bold; }

        /* Audio Player Mini */
        .audio-trigger { position: absolute; left: -50px; top: 55px; opacity: 0; transition: 0.3s; }
        .ayah-card:hover .audio-trigger { opacity: 1; left: -40px; }

        /* Hifz Mode Overlay */
        body.hifz .ar { filter: blur(12px); transition: 0.3s; }
        body.hifz .ar:hover { filter: blur(0); }

        /* Loading State */
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 3px; background: var(--p); transform: scaleX(0); transform-origin: left; transition: 0.4s; z-index: 1000; }
    </style>
</head>
<body data-theme="midnight">

    <div id="loader"></div>

    <nav>
        <div class="nav-btn" onclick="Engine.load(1)" title="Home"><i data-lucide="home"></i></div>
        <div class="nav-btn" onclick="Engine.toggleHifz()" id="hifz-toggle" title="Hifz Mode"><i data-lucide="brain"></i></div>
        <div class="nav-btn" onclick="Engine.cycleTheme()" title="Change Theme"><i data-lucide="palette"></i></div>
    </nav>

    <main id="main-scroll">
        <div class="container">
            <header>
                <div>
                    <h1 id="surah-name" style="margin:0; font-size: 1.5rem;">Sovereign</h1>
                    <span id="surah-desc" style="font-size: 0.8rem; color: var(--sub);">Select a chapter to begin</span>
                </div>
                <div class="search-group">
                    <i data-lucide="search" size="18" style="color:var(--sub)"></i>
                    <input type="text" id="search-input" placeholder="Surah name or number..." onkeypress="if(event.key==='Enter') Engine.search(this.value)">
                </div>
            </header>

            <div id="reader-stage">
                </div>
        </div>
    </main>

    <script>
        const Engine = {
            state: { surah: 1, theme: 'midnight', hifz: false },
            themes: ['midnight', 'sepia', 'light'],

            async load(id) {
                const loader = document.getElementById('loader');
                const stage = document.getElementById('reader-stage');
                loader.style.transform = 'scaleX(0.4)';
                
                try {
                    // Pulling from Unified Quran.cloud for stability
                    const [arRes, enRes] = await Promise.all([
                        fetch(`https://api.quran.com/api/v4/quran/verses/uthmani?chapter_number=${id}`).then(r => r.json()),
                        fetch(`https://api.alquran.cloud/v1/surah/${id}/en.sahih`).then(r => r.json())
                    ]);

                    loader.style.transform = 'scaleX(0.8)';
                    document.getElementById('surah-name').innerText = enRes.data.englishName;
                    document.getElementById('surah-desc').innerText = `${enRes.data.englishNameTranslation} â€¢ ${enRes.data.numberOfAyahs} Verses`;

                    stage.innerHTML = arRes.verses.map((v, i) => `
                        <div class="ayah-card" onclick="Engine.playAudio('${id}', '${i+1}', this)">
                            <div class="meta-tag">VERSE ${i+1}</div>
                            <div class="audio-trigger"><i data-lucide="play-circle"></i></div>
                            <div class="ar">${v.text_uthmani}</div>
                            <div class="en">${enRes.data.ayahs[i].text}</div>
                        </div>
                    `).join('');

                    lucide.createIcons();
                    loader.style.transform = 'scaleX(1)';
                    setTimeout(() => loader.style.transform = 'scaleX(0)', 400);
                    document.getElementById('main-scroll').scrollTop = 0;

                } catch (err) {
                    stage.innerHTML = `<h2 style="color:red; text-align:center;">Engine Error: Check Connection</h2>`;
                }
            },

            playAudio(surah, ayah, element) {
                // Pad numbers for the audio API (e.g. 1 -> 001)
                const s = surah.toString().padStart(3, '0');
                const a = ayah.toString().padStart(3, '0');
                const audio = new Audio(`https://everyayah.com/data/Alafasy_128kbps/${s}${a}.mp3`);
                
                // Visual feedback
                const cards = document.querySelectorAll('.ayah-card');
                cards.forEach(c => c.style.borderLeft = 'none');
                element.style.borderLeft = '4px solid var(--p)';
                
                audio.play();
            },

            search(val) {
                if(!val) return;
                this.load(val); // In a perfect build, we'd map names here too
            },

            cycleTheme() {
                const next = this.themes[(this.themes.indexOf(this.state.theme) + 1) % this.themes.length];
                this.state.theme = next;
                document.body.setAttribute('data-theme', next);
            },

            toggleHifz() {
                this.state.hifz = !this.state.hifz;
                document.body.classList.toggle('hifz');
                document.getElementById('hifz-toggle').classList.toggle('active');
            }
        };

        window.onload = () => {
            lucide.createIcons();
            Engine.load(1);
        };
    </script>
</body>
</html>
