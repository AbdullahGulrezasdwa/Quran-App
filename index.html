<style>
  /* 1. RESPONSIVE ALIGNMENT FIX */
  body { display: flex; overflow: hidden; height: 100vh; transition: var(--transition); }
  
  /* Container that holds the main content and the settings drawer */
  #main-stage {
    flex: 1;
    display: flex;
    position: relative;
    overflow: hidden;
  }

  main { 
    flex: 1; 
    overflow-y: auto; 
    transition: margin-right 0.5s cubic-bezier(0.16, 1, 0.3, 1);
    padding: 0 20px;
  }

  /* When settings open, main content pushes left and stays visible */
  body.settings-open main { margin-right: 400px; }

  /* 2. PLAY BUTTON POLISH (Fixing the "Rigged" look) */
  .play-btn {
    width: 54px;
    height: 54px;
    border-radius: 50%;
    background: var(--primary);
    border: none;
    color: var(--bg);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    transition: transform 0.2s, background 0.3s, box-shadow 0.3s;
  }
  
  .play-btn:hover { transform: scale(1.05); box-shadow: 0 6px 20px var(--primary); }
  .play-btn:active { transform: scale(0.95); }

  /* 3. CONDITIONAL PLAYER VISIBILITY */
  .player-dock {
    position: fixed;
    bottom: 25px;
    left: 50%;
    transform: translateX(-50%) translateY(200%); /* Hidden by default */
    opacity: 0;
    transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s ease;
    /* ... rest of your dock styles ... */
  }

  /* Show player only when active */
  body.surah-active .player-dock {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
  }

  /* Automatically hide when scrolling down in a surah */
  body.surah-active .player-dock.scrolled {
    transform: translateX(-50%) translateY(150%);
    opacity: 0;
  }
</style>

<script>
  // UPDATED LOGIC FOR CONDITIONAL PLAYER
  Sanctuary.loadSurah = async function(id) {
    // 1. Show the player dock immediately when a surah is selected
    document.body.classList.add('surah-active');
    
    // 2. Clear current view and show loader
    const view = document.getElementById('app-view');
    view.innerHTML = `<div style="text-align:center; padding:100px;">Opening Sanctuary...</div>`;

    const [ar, en] = await Promise.all([
      fetch(`https://api.alquran.cloud/v1/surah/${id}/quran-uthmani`).then(r => r.json()),
      fetch(`https://api.alquran.cloud/v1/surah/${id}/en.sahih`).then(r => r.json())
    ]);
    
    this.state.arData = ar.data;
    this.renderVerses(ar.data, en.data);
  };

  // Logic to return to Home/Library and hide player
  Sanctuary.renderHome = function() {
    document.body.classList.remove('surah-active');
    // ... existing home rendering logic ...
  };

  // SCROLL-SENSITIVE PLAYER LOGIC
  let lastScroll = 0;
  document.getElementById('scroller').addEventListener('scroll', (e) => {
    const currentScroll = e.target.scrollTop;
    const dock = document.querySelector('.player-dock');
    
    if (currentScroll > lastScroll && currentScroll > 150) {
      dock.classList.add('scrolled'); // Hide on scroll down
    } else {
      dock.classList.remove('scrolled'); // Show on scroll up
    }
    lastScroll = currentScroll;
  });
</script>
