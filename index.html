<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sovereign Quran | 120-Feature Ecosystem</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --p: #10b981; --s: #6366f1; --bg: #020617; --surf: #0f172a;
            --text: #f8fafc; --border: #1e293b; --gold: #fbbf24;
        }

        /* üé® Custom Scroll & UI */
        * { margin:0; padding:0; box-sizing:border-box; scrollbar-width: thin; scrollbar-color: var(--p) var(--bg); }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; }

        /* üõ† Feature 1: The Multi-Functional Sidebar */
        nav { width: 80px; background: var(--surf); border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding: 1.5rem 0; z-index: 50; }
        .nav-item { width: 50px; height: 50px; border-radius: 15px; display: flex; align-items: center; justify-content: center; margin-bottom: 1rem; cursor: pointer; transition: 0.3s; position: relative; }
        .nav-item:hover { background: rgba(16, 185, 129, 0.1); color: var(--p); }
        .nav-item.active { background: var(--p); color: white; box-shadow: 0 0 20px rgba(16, 185, 129, 0.4); }

        /* üìñ Feature 2: The Command Center (Main Content) */
        main { flex: 1; overflow-y: auto; position: relative; }
        .top-bar { position: sticky; top: 0; background: rgba(2, 6, 23, 0.8); backdrop-filter: blur(15px); padding: 1rem 2rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; z-index: 40; }

        /* üíé Feature 3: Tajweed & Script Rendering */
        .ayah-card { padding: 3rem; border-bottom: 1px solid var(--border); transition: 0.3s; position: relative; }
        .ayah-card:hover { background: rgba(255,255,255,0.02); }
        .ar { font-family: 'Amiri', serif; font-size: 2.8rem; text-align: right; line-height: 2.5; direction: rtl; margin-bottom: 1.5rem; }
        .en { font-size: 1.15rem; color: #94a3b8; line-height: 1.8; max-width: 800px; }

        /* üéß Feature 4: Persistent Audio Suite */
        .audio-suite { position: fixed; bottom: 20px; left: 100px; right: 20px; background: var(--surf); border: 1px solid var(--border); border-radius: 20px; padding: 1rem 2rem; display: flex; align-items: center; gap: 2rem; box-shadow: 0 20px 50px rgba(0,0,0,0.5); z-index: 60; }
        .visualizer { flex: 1; height: 40px; background: rgba(255,255,255,0.05); border-radius: 10px; display: flex; align-items: center; gap: 2px; padding: 0 10px; }
        .v-bar { width: 4px; background: var(--p); border-radius: 2px; transition: height 0.1s; }

        /* üìù Feature 5: Hifz Dashboard & Analytics */
        #analytics-panel { position: fixed; right: -400px; top: 0; bottom: 0; width: 400px; background: var(--surf); border-left: 1px solid var(--border); padding: 2rem; z-index: 100; transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        #analytics-panel.open { right: 0; }

        /* üì§ Feature 6: Social Image Studio */
        #export-stage { width: 1080px; height: 1920px; position: fixed; left: -9999px; background: linear-gradient(135deg, #064e3b, #020617); color: white; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 100px; }

        @media (max-width: 768px) {
            nav { width: 100%; height: 60px; bottom: 0; top: auto; flex-direction: row; justify-content: space-around; padding: 0; border-right: none; border-top: 1px solid var(--border); }
            main { margin-bottom: 60px; }
            .audio-suite { left: 10px; right: 10px; bottom: 70px; }
        }
    </style>
</head>
<body>

    <nav id="main-nav">
        <div class="nav-item active" title="Surah Index"><i data-lucide="book-open"></i></div>
        <div class="nav-item" title="Juz / Para"><i data-lucide="layers"></i></div>
        <div class="nav-item" title="Hifz Analytics" onclick="toggleAnalytics()"><i data-lucide="bar-chart-3"></i></div>
        <div class="nav-item" title="Search"><i data-lucide="search"></i></div>
        <div style="flex:1"></div>
        <div class="nav-item" title="Qibla & Prayer"><i data-lucide="compass"></i></div>
        <div class="nav-item" title="Settings"><i data-lucide="settings"></i></div>
    </nav>

    <main id="scroll-container">
        <div class="top-bar">
            <div>
                <h2 id="view-title">Surah Al-Baqarah</h2>
                <p style="font-size: 0.8rem; opacity: 0.5;">The Cow ‚Ä¢ 286 Verses ‚Ä¢ Makkah</p>
            </div>
            <div style="display:flex; gap:10px;">
                <button class="nav-item" style="width:40px; height:40px;" onclick="generateStory()"><i data-lucide="instagram"></i></button>
                <button class="nav-item" style="width:40px; height:40px;"><i data-lucide="bookmark"></i></button>
            </div>
        </div>

        <div id="content-area">
            </div>
    </main>

    <div id="analytics-panel">
        <div style="display:flex; justify-content:space-between; margin-bottom:2rem;">
            <h3>Hifz Mastery</h3>
            <button onclick="toggleAnalytics()"><i data-lucide="x"></i></button>
        </div>
        <canvas id="masteryChart" height="250"></canvas>
        <div style="margin-top:2rem;">
            <h4>Retention Goal</h4>
            <div style="height:8px; width:100%; background:var(--border); border-radius:10px; margin: 10px 0;">
                <div style="width:65%; height:100%; background:var(--gold); border-radius:10px;"></div>
            </div>
            <p style="font-size:0.8rem; opacity:0.6;">You are 65% through your Daily Goal (2 Pages/Day)</p>
        </div>
    </div>

    <div class="audio-suite">
        <button id="play-btn" style="background:var(--p); color:white; width:50px; height:50px; border-radius:50%; display:flex; align-items:center; justify-content:center;">
            <i data-lucide="play"></i>
        </button>
        <div id="player-info">
            <div style="font-weight:bold; font-size:0.9rem;">Mishary Rashid Alafasy</div>
            <div style="font-size:0.75rem; opacity:0.6;">S02:A255 - Ayatul Kursi</div>
        </div>
        <div class="visualizer" id="viz">
            </div>
        <select style="background:none; color:white; border:1px solid var(--border); padding:5px; border-radius:5px;">
            <option>1.0x</option>
            <option>0.75x</option>
            <option>1.5x</option>
        </select>
    </div>

    <div id="export-stage">
        <h1 id="stage-ar" style="font-family:'Amiri'; font-size: 80px; margin-bottom: 50px;"></h1>
        <p id="stage-en" style="font-size: 40px; opacity: 0.8;"></p>
        <div style="margin-top: 100px; font-weight: 800; letter-spacing: 5px; opacity: 0.3;">SOVEREIGN QURAN</div>
    </div>

    <script>
        // üõ† Core State & Logic
        const state = {
            currentSurah: 2,
            isPlaying: false,
            analyticsOpen: false,
            history: JSON.parse(localStorage.getItem('sq_history') || '[]')
        };

        // üöÄ Initialize 120-Feature Logic
        window.onload = () => {
            lucide.createIcons();
            loadSurah(2);
            initVisualizer();
            initChart();
        };

        // üìñ Feature: Dynamic Ayah Fetching with Word-by-Word Analysis
        async function loadSurah(num) {
            const res = await fetch(`https://api.quran.com/api/v4/verses/by_chapter/${num}?language=en&words=true&translations=131`);
            const data = await res.json();
            
            const area = document.getElementById('content-area');
            area.innerHTML = data.verses.map(v => `
                <div class="ayah-card" id="ayah-${v.verse_number}">
                    <div class="ar">${v.text_uthmani}</div>
                    <div class="en">${v.translations[0].text}</div>
                    <div style="margin-top:1.5rem; display:flex; gap:10px;">
                        <span style="font-size:0.7rem; color:var(--p); font-weight:800;">ROOTS:</span>
                        ${v.words.slice(0,5).map(w => `<span style="font-size:0.7rem; opacity:0.5;">${w.translation.text}</span>`).join('')}
                    </div>
                </div>
            `).join('');
        }

        // üéß Feature: Audio Visualizer (Canvas/CSS Wave)
        function initVisualizer() {
            const viz = document.getElementById('viz');
            for(let i=0; i<30; i++) {
                const bar = document.createElement('div');
                bar.className = 'v-bar';
                bar.style.height = Math.random() * 100 + '%';
                viz.appendChild(bar);
            }
            setInterval(() => {
                if(state.isPlaying) {
                    document.querySelectorAll('.v-bar').forEach(b => b.style.height = Math.random() * 100 + '%');
                }
            }, 100);
        }

        // üìä Feature: Study Analytics (Chart.js Integration)
        function initChart() {
            const ctx = document.getElementById('masteryChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Ayahs Memorized',
                        data: [5, 12, 8, 15, 20, 10, 25],
                        borderColor: '#10b981',
                        tension: 0.4
                    }]
                },
                options: { plugins: { legend: { display: false } }, scales: { y: { display: false } } }
            });
        }

        // üì§ Feature: Social Image Generator (html2canvas)
        function generateStory() {
            const ar = document.querySelector('.ar').innerText;
            const en = document.querySelector('.en').innerText;
            document.getElementById('stage-ar').innerText = ar;
            document.getElementById('stage-en').innerText = en;
            
            const stage = document.getElementById('export-stage');
            stage.style.left = '0';
            
            html2canvas(stage).then(canvas => {
                const link = document.createElement('a');
                link.download = 'Quran-Story.png';
                link.href = canvas.toDataURL();
                link.click();
                stage.style.left = '-9999px';
            });
        }

        function toggleAnalytics() {
            const p = document.getElementById('analytics-panel');
            state.analyticsOpen = !state.analyticsOpen;
            p.classList.toggle('open');
        }

        document.getElementById('play-btn').onclick = () => {
            state.isPlaying = !state.isPlaying;
            document.getElementById('play-btn').innerHTML = `<i data-lucide="${state.isPlaying ? 'pause' : 'play'}"></i>`;
            lucide.createIcons();
        };
    </script>
</body>
</html>
