<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sanctuary Quran</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='80'>ðŸ“–</text></svg>">
  <script src="https://unpkg.com/lucide@latest"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&family=Amiri+Quran&display=swap" rel="stylesheet" />
  <style>
    :root {
      --primary: #fbbf24; --bg: #030712; --card: #111827; --text: #f3f4f6; --muted: #9ca3af;
      --border: rgba(255,255,255,0.08); --arabic-font: 'Amiri Quran', serif;
      --nav-w: 90px; --side-w: 420px; --player-h: 120px;
      /* Dynamic Variables */
      --quran-size: 5.5rem; --quran-weight: 400; --verse-spacing: 80px;
    }

    /* Production Zoom Scaling */
    html { transform: scale(0.67); transform-origin: top left; width: 149.25%; height: 149.25%; overflow: hidden; }

    /* 15 THEME ENGINE */
    body.t-dark-gold { --bg: #000; --card: #0a0a0a; --primary: #fbbf24; }
    body.t-midnight-emerald { --bg: #022c22; --card: #064e3b; --primary: #34d399; }
    body.t-deep-ocean { --bg: #0f172a; --card: #1e293b; --primary: #38bdf8; }
    body.t-royal-purple { --bg: #2e1065; --card: #4c1d95; --primary: #c084fc; }
    body.t-rose-quartz { --bg: #450a0a; --card: #7f1d1d; --primary: #f87171; }
    body.t-slate-gray { --bg: #111827; --card: #1f2937; --primary: #94a3b8; }
    body.t-nordic { --bg: #f8fafc; --card: #f1f5f9; --text: #0f172a; --muted: #64748b; --border: #e2e8f0; --primary: #2563eb; }
    body.t-sepia { --bg: #2d241e; --card: #3d3028; --primary: #d97706; }
    body.t-carbon { --bg: #121212; --card: #181818; --primary: #ffffff; }
    body.t-neon { --bg: #000; --card: #050505; --primary: #00ff41; --border: #00ff4133; }

    * { box-sizing: border-box; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
    body { margin: 0; font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); height: 100vh; display: flex; }

    /* LAYOUT COMPONENTS */
    nav { width: var(--nav-w); border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding: 30px 0; gap: 25px; flex-shrink: 0; background: var(--bg); }
    main { flex: 1; overflow-y: auto; scroll-behavior: smooth; position: relative; }
    aside { width: var(--side-w); border-left: 1px solid var(--border); background: var(--card); padding: 40px; overflow-y: auto; flex-shrink: 0; display: none; }
    aside.visible { display: block; }

    .container { max-width: 1300px; margin: 0 auto; padding: 60px 40px 250px 40px; }

    /* QURAN TEXT STYLING */
    .bismillah { font-family: var(--arabic-font); font-size: 7rem; text-align: center; margin-bottom: 100px; }
    .ayah-row { padding: var(--verse-spacing) 0; border-bottom: 1px solid var(--border); }
    .ayah-row.active { background: rgba(255,255,255,0.03); border-radius: 20px; padding-left: 30px; border-bottom-color: var(--primary); }
    
    .arabic { font-family: var(--arabic-font); font-size: var(--quran-size); font-weight: var(--quran-weight); direction: rtl; line-height: 2.2; text-align: right; display: block; }
    .translation { font-size: 2.2rem; line-height: 1.8; color: var(--muted); margin-top: 30px; font-weight: 300; }
    
    /* MODALS */
    .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(10px); display: none; align-items: center; justify-content: center; z-index: 1000; }
    .modal-content { background: var(--card); padding: 50px; border-radius: 40px; border: 1px solid var(--border); width: 600px; }

    /* INPUTS & BUTTONS */
    .btn { background: var(--card); color: var(--text); border: 1px solid var(--border); padding: 18px 30px; border-radius: 20px; cursor: pointer; font-size: 1.3rem; font-weight: 600; display: inline-flex; align-items: center; gap: 12px; }
    .btn:hover { border-color: var(--primary); transform: translateY(-3px); }
    .btn-primary { background: var(--primary); color: #000; border: none; }
    
    .slider { width: 100%; height: 8px; border-radius: 5px; background: var(--border); outline: none; -webkit-appearance: none; margin: 20px 0; }
    .slider::-webkit-scrollbar-thumb { background: var(--primary); }

    .player-bar { position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%); width: 92%; height: var(--player-h); background: rgba(10,10,10,0.9); backdrop-filter: blur(30px); border: 1px solid var(--border); border-radius: 40px; display: flex; align-items: center; justify-content: space-between; padding: 0 60px; z-index: 100; box-shadow: 0 30px 60px rgba(0,0,0,0.6); }

    .theme-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 20px; }
    .theme-chip { height: 60px; border-radius: 12px; cursor: pointer; border: 2px solid transparent; }
  </style>
</head>
<body class="t-dark-gold">

  <nav>
    <div style="color:var(--primary); margin-bottom: 40px;"><i data-lucide="book-marked" size="40"></i></div>
    <div class="btn" style="padding:15px; border:none;" onclick="updateRoute('home')"><i data-lucide="home" size="32"></i></div>
    <div class="btn" style="padding:15px; border:none;" onclick="toggleModal('settings-modal')"><i data-lucide="sliders" size="32"></i></div>
    <div class="btn" style="padding:15px; border:none;" onclick="toggleModal('theme-modal')"><i data-lucide="palette" size="32"></i></div>
  </nav>

  <main id="scroll-main">
    <div class="container" id="view-container"></div>
  </main>

  <aside id="sidebar">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2 style="font-size: 2rem;">Tafsir Insight</h2>
        <button class="btn" onclick="toggleSidebar()"><i data-lucide="x"></i></button>
    </div>
    <div id="side-content" style="margin-top:40px; font-size: 1.5rem; line-height: 1.7; color: var(--muted);">
        Select a verse to view explanation.
    </div>
  </aside>

  <div id="settings-modal" class="modal" onclick="toggleModal('settings-modal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h2 style="font-size: 2.5rem; margin-bottom: 30px;">Reading Experience</h2>
        
        <label>Arabic Font Size</label>
        <input type="range" class="slider" min="3" max="10" step="0.5" value="5.5" oninput="updateStyle('--quran-size', this.value + 'rem')">
        
        <label>Verse Spacing</label>
        <input type="range" class="slider" min="40" max="200" step="10" value="80" oninput="updateStyle('--verse-spacing', this.value + 'px')">
        
        <label>Arabic Boldness</label>
        <input type="range" class="slider" min="300" max="900" step="100" value="400" oninput="updateStyle('--quran-weight', this.value)">

        <button class="btn btn-primary" style="width:100%; margin-top:30px;" onclick="toggleModal('settings-modal')">Save Preferences</button>
    </div>
  </div>

  <div id="theme-modal" class="modal" onclick="toggleModal('theme-modal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h2>Select Appearance</h2>
        <div class="theme-grid" id="theme-list"></div>
    </div>
  </div>

  <div class="player-bar">
    <div style="width: 400px;">
        <div id="p-title" style="font-size: 1.8rem; font-weight: 700;">Al-Fatiha</div>
        <div id="p-subtitle" class="text-muted" style="font-size: 1.3rem;">Mishary Al-Afasy</div>
    </div>
    <div style="display:flex; gap:50px; align-items:center;">
        <button class="btn-primary" style="width:100px; height:100px; border-radius:50%;" onclick="toggleAudio()">
            <i data-lucide="play" size="40" fill="currentColor" id="play-icon"></i>
        </button>
    </div>
    <div style="width: 400px; text-align: right;">
        <button class="btn" onclick="toggleSidebar()">OPEN SIDEBAR <i data-lucide="panel-right-open"></i></button>
    </div>
  </div>

  <audio id="audio-player"></audio>

  <script>
    const App = {
      themes: ['dark-gold', 'midnight-emerald', 'deep-ocean', 'royal-purple', 'rose-quartz', 'slate-gray', 'nordic', 'sepia', 'carbon', 'neon'],
      async init() {
        lucide.createIcons();
        this.renderThemeChips();
        const res = await fetch('https://api.alquran.cloud/v1/surah');
        const data = await res.json();
        this.chapters = data.data;
        this.router();
      },

      renderThemeChips() {
        const container = document.getElementById('theme-list');
        container.innerHTML = this.themes.map(t => `<div class="theme-chip t-${t}" onclick="setTheme('t-${t}')" style="background: var(--bg); border: 1px solid var(--border)"></div>`).join('');
      },

      router() {
        const params = new URLSearchParams(window.location.search);
        const surahId = params.get('surah');
        if (surahId) this.renderReader(surahId);
        else this.renderHome();
      },

      async renderHome() {
        let html = `<h1 style="font-size:4rem; margin-bottom:60px;">Noble Sanctuary</h1><div style="display:grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap:30px;">`;
        html += this.chapters.map(s => `
          <div class="card btn" style="display:block; padding:40px; text-align:left;" onclick="updateRoute('surah', ${s.number})">
            <div style="color:var(--primary); font-size:1.5rem; font-weight:800;">${s.number}</div>
            <h3 style="font-size:2.5rem; margin:15px 0;">${s.englishName}</h3>
            <p style="font-size:1.3rem; opacity:0.6;">${s.numberOfAyahs} Ayahs</p>
          </div>
        `).join('') + `</div>`;
        document.getElementById('view-container').innerHTML = html;
        lucide.createIcons();
      },

      async renderReader(id) {
        const [ar, en] = await Promise.all([
          fetch(`https://api.alquran.cloud/v1/surah/${id}/quran-uthmani`).then(r => r.json()),
          fetch(`https://api.alquran.cloud/v1/surah/${id}/en.sahih`).then(r => r.json())
        ]);
        
        let html = `<div class="bismillah">${ar.data.name}</div>`;
        ar.data.ayahs.forEach((ayah, i) => {
          html += `<div class="ayah-row" id="ayah-${i}">
            <div class="arabic">${ayah.text} <span style="color:var(--primary); font-size:2rem; margin-right:20px;">â—‹ ${i+1}</span></div>
            <div class="translation">${en.data.ayahs[i].text}</div>
            <div style="margin-top:30px; display:flex; gap:20px;">
                <button class="btn" onclick="App.loadTafsir(${id}, ${i+1})"><i data-lucide="book-open"></i> Tafsir</button>
                <button class="btn" onclick="App.playVerse(${i})"><i data-lucide="play-circle"></i> Play</button>
            </div>
          </div>`;
        });
        document.getElementById('view-container').innerHTML = html;
        lucide.createIcons();
      },

      async loadTafsir(surah, ayah) {
        document.getElementById('sidebar').classList.add('visible');
        document.getElementById('side-content').innerHTML = "Fetching explanation...";
        const res = await fetch(`https://api.alquran.cloud/v1/ayah/${surah}:${ayah}/ar.jalalayn`);
        const data = await res.json();
        document.getElementById('side-content').innerHTML = `<p style="font-family:var(--arabic-font); font-size:2.2rem; direction:rtl; text-align:right;">${data.data.text}</p>`;
      }
    };

    function updateStyle(prop, val) { document.documentElement.style.setProperty(prop, val); }
    function toggleModal(id) { const m = document.getElementById(id); m.style.display = m.style.display === 'flex' ? 'none' : 'flex'; }
    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('visible'); }
    function setTheme(t) { document.body.className = t; }
    function updateRoute(type, val) {
      const url = new URL(window.location);
      if (type === 'surah') url.searchParams.set('surah', val);
      else url.searchParams.delete('surah');
      window.history.pushState({}, '', url);
      App.router();
    }

    window.onload = () => App.init();
  </script>
</body>
</html>
