<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sanctuary | Sovereign</title>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600&family=Amiri+Quran&family=Noto+Sans+Arabic:wght@400;700&display=swap" rel="stylesheet" />
  
  <style>
    :root {
      --bg: #010c09; --card: #021a14; --primary: #10b981; --text: #ecfdf5; --muted: #6ee7b7;
      --border: rgba(16, 185, 129, 0.1); --font-ar: 'Amiri Quran', serif; --ar-size: 2.8rem;
      --gold: #fbbf24; --transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
    }

    /* Theme Matrix */
    body.t-dark-gold { --bg: #0d0d0d; --card: #1a1a1a; --primary: #d4af37; --text: #f2f2f2; }
    body.t-midnight { --bg: #020617; --card: #0f172a; --primary: #38bdf8; --text: #f1f5f9; }
    body.t-rose { --bg: #1c0a0a; --card: #2d1616; --primary: #fb7185; --text: #fff1f2; }
    body.t-nord { --bg: #2e3440; --card: #3b4252; --primary: #88c0d0; --text: #eceff4; }
    body.t-paper { --bg: #f9f7f1; --card: #ffffff; --primary: #704214; --text: #2c1e12; }

    body { margin: 0; font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); overflow: hidden; display: flex; height: 100vh; }
    
    /* Layout Architecture */
    .nav-rail { width: 80px; border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding: 20px 0; gap: 20px; background: var(--bg); z-index: 1000; }
    
    main { flex: 1; overflow-y: auto; scroll-behavior: smooth; transition: var(--transition); position: relative; }
    body.settings-open main { margin-right: 400px; } /* Shrink view when settings open */

    .content-max { max-width: 900px; margin: 0 auto; padding: 40px 20px 300px 20px; }

    /* Verse Styles */
    .ayah-row { padding: 30px 0; border-bottom: 1px solid var(--border); transition: var(--transition); }
    .reading-view .ayah-row { display: inline; border: none; padding: 0; line-height: 3; }
    .reading-view .translation { display: none !important; }

    .arabic { font-family: var(--font-ar); font-size: var(--ar-size); direction: rtl; line-height: 2.2; text-align: right; transition: var(--transition); }
    body.hifz-mode .arabic { filter: blur(12px); }
    body.hifz-mode .arabic:hover { filter: blur(0); }
    
    body.hide-trans .translation { display: none; }

    /* UI Components */
    .btn-ui { background: none; border: none; color: var(--text); cursor: pointer; padding: 12px; border-radius: 16px; transition: var(--transition); display: flex; align-items: center; justify-content: center; }
    .btn-ui:hover, .btn-ui.active { background: var(--border); color: var(--primary); transform: scale(1.1); }

    .player-dock { 
      position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); 
      width: 90%; max-width: 800px; background: var(--card); border: 1px solid var(--border); 
      border-radius: 24px; padding: 15px 30px; display: flex; align-items: center; justify-content: space-between; 
      z-index: 1100; backdrop-filter: blur(15px); box-shadow: 0 20px 40px rgba(0,0,0,0.4);
    }

    .play-btn { width: 50px; height: 50px; border-radius: 50%; background: var(--primary); border: none; color: var(--bg); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: var(--transition); }
    body.playing .play-btn { background: var(--gold); transform: scale(1.1); }

    /* Settings Panel */
    .drawer { position: fixed; right: -400px; top: 0; width: 400px; height: 100%; background: var(--card); border-left: 1px solid var(--border); z-index: 2000; transition: var(--transition); padding: 30px; overflow-y: auto; }
    .drawer.open { right: 0; }
    .theme-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin: 15px 0; }
    .theme-dot { height: 35px; border-radius: 8px; cursor: pointer; border: 2px solid rgba(255,255,255,0.1); }

    /* Home Dashboard */
    .home-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px; }
    .stat-card { background: var(--card); padding: 25px; border-radius: 20px; border: 1px solid var(--border); }
  </style>
</head>
<body class="t-midnight">

  <div id="settings-panel" class="drawer">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px">
        <h3 style="margin:0">Preferences</h3>
        <button onclick="Sanctuary.toggleSettings()" class="btn-ui"><i data-lucide="x"></i></button>
    </div>

    <label>Script Style</label>
    <select onchange="Sanctuary.updateFont(this.value)" style="width:100%; padding:12px; background:var(--bg); color:white; border:1px solid var(--border); border-radius:10px; margin:10px 0">
        <option value="'Amiri Quran'">Uthmani (Classic)</option>
        <option value="'Noto Sans Arabic'">IndoPak (Bold)</option>
    </select>

    <label>View Mode</label>
    <div style="display:flex; gap:10px; margin:15px 0">
        <button class="btn-ui" onclick="Sanctuary.setView('verse')" style="border:1px solid var(--border); flex:1">Verse</button>
        <button class="btn-ui" onclick="Sanctuary.setView('reading')" style="border:1px solid var(--border); flex:1">Reading</button>
    </div>

    <div style="display:flex; justify-content:space-between; align-items:center; margin:20px 0">
        <span>Show Translation</span>
        <input type="checkbox" checked onchange="document.body.classList.toggle('hide-trans')">
    </div>

    <label>Theme Matrix</label>
    <div class="theme-grid" id="theme-container"></div>
  </div>

  <nav class="nav-rail">
    <button class="btn-ui" id="btn-home" onclick="Sanctuary.renderHome()"><i data-lucide="layout-dashboard"></i></button>
    <button class="btn-ui" id="btn-lib" onclick="Sanctuary.renderLibrary()"><i data-lucide="book-marked"></i></button>
    <button class="btn-ui" id="btn-hifz" onclick="Sanctuary.toggleHifz()"><i data-lucide="brain"></i></button>
    <button class="btn-ui" onclick="Sanctuary.toggleSettings()"><i data-lucide="settings"></i></button>
  </nav>

  <main id="scroller">
    <div class="content-max" id="app-view"></div>
  </main>

  <div class="player-dock">
    <div id="meta-box"><div id="p-surah" style="font-weight:600">Sanctuary</div><div id="p-ayah" style="font-size:0.75rem; opacity:0.5">Ready</div></div>
    <div style="display:flex; align-items:center; gap:20px">
        <button class="btn-ui" onclick="Sanctuary.stepVerse(-1)"><i data-lucide="skip-back"></i></button>
        <button class="play-btn" onclick="Sanctuary.toggleAudio()">
            <i data-lucide="play" id="play-icon" size="20" fill="currentColor"></i>
            <i data-lucide="pause" id="pause-icon" size="20" fill="currentColor"></i>
        </button>
        <button class="btn-ui" onclick="Sanctuary.stepVerse(1)"><i data-lucide="skip-forward"></i></button>
    </div>
    <button class="btn-ui" onclick="Sanctuary.toggleTafsir()"><i data-lucide="message-square-quote"></i></button>
  </div>

  <audio id="core-audio"></audio>

  <script>
    const Sanctuary = {
      themes: ['midnight', 'dark-gold', 'rose', 'nord', 'paper', 'forest', 'coffee', 'purple', 'minimal', 'sakura'],
      state: { view: 'verse', hifz: false, curIdx: -1, arData: null },

      init() {
        this.audio = document.getElementById('core-audio');
        this.renderThemeGrid();
        fetch('https://api.alquran.cloud/v1/surah').then(r => r.json()).then(d => {
            this.state.surahs = d.data;
            this.renderHome();
        });
        lucide.createIcons();
      },

      renderThemeGrid() {
        const container = document.getElementById('theme-container');
        this.themes.forEach(t => {
            const dot = document.createElement('div');
            dot.className = `theme-dot t-${t}`;
            dot.style.background = 'var(--primary)';
            dot.onclick = () => document.body.className = `t-${t}`;
            container.appendChild(dot);
        });
      },

      renderHome() {
        const view = document.getElementById('app-view');
        view.innerHTML = `
            <h1>The Noble Sanctuary</h1>
            <div class="home-grid">
                <div class="stat-card"><h3>Continue</h3><p style="opacity:0.6">Al-Baqarah: Verse 5</p></div>
                <div class="stat-card"><h3>Daily Goal</h3><p style="opacity:0.6">15 / 30 Minutes</p></div>
            </div>
            <h2 style="margin-top:40px">Quick Access</h2>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px">
                <div class="btn-ui" onclick="Sanctuary.loadSurah(1)" style="border:1px solid var(--border); padding:20px; justify-content:start">Al-Fatiha</div>
                <div class="btn-ui" onclick="Sanctuary.loadSurah(18)" style="border:1px solid var(--border); padding:20px; justify-content:start">Al-Kahf</div>
            </div>`;
      },

      renderLibrary() {
        const view = document.getElementById('app-view');
        view.innerHTML = `<h1>Library</h1><div style="display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:15px">` + 
            this.state.surahs.map(s => `<div class="btn-ui" onclick="Sanctuary.loadSurah(${s.number})" style="display:block; text-align:left; border:1px solid var(--border); padding:20px; border-radius:15px"><strong>${s.englishName}</strong><br><small style="opacity:0.5">${s.numberOfAyahs} Ayahs</small></div>`).join('') + `</div>`;
      },

      async loadSurah(id) {
        const [ar, en] = await Promise.all([
          fetch(`https://api.alquran.cloud/v1/surah/${id}/quran-uthmani`).then(r => r.json()),
          fetch(`https://api.alquran.cloud/v1/surah/${id}/en.sahih`).then(r => r.json())
        ]);
        this.state.arData = ar.data;
        this.renderVerses(ar.data, en.data);
      },

      renderVerses(ar, en) {
        const view = document.getElementById('app-view');
        document.getElementById('p-surah').innerText = ar.englishName;
        let html = `<h2 style="text-align:center; font-family:var(--font-ar); font-size:3.5rem; margin-bottom:50px">${ar.name}</h2>`;
        
        ar.ayahs.forEach((v, i) => {
          html += `<div class="ayah-row" id="v-${i}" onclick="Sanctuary.prepVerse(${v.number}, ${i})">
            <div class="arabic">${v.text}</div>
            <div class="translation">${en.ayahs[i].text}</div>
          </div>`;
        });
        view.innerHTML = html;
        view.className = `content-max ${this.state.view}-view`;
      },

      prepVerse(gid, idx) {
        this.state.curIdx = idx;
        this.audio.src = `https://cdn.islamic.network/quran/audio/128/ar.alafasy/${gid}.mp3`;
        this.audio.play();
        document.body.classList.add('playing');
        document.getElementById('p-ayah').innerText = `Verse ${idx + 1}`;
      },

      toggleAudio() {
        this.audio.paused ? this.audio.play() : this.audio.pause();
        document.body.classList.toggle('playing', !this.audio.paused);
      },

      toggleHifz() {
        this.state.hifz = !this.state.hifz;
        document.body.classList.toggle('hifz-mode', this.state.hifz);
        document.getElementById('btn-hifz').classList.toggle('active');
      },

      toggleSettings() {
        const panel = document.getElementById('settings-panel');
        panel.classList.toggle('open');
        document.body.classList.toggle('settings-open', panel.classList.contains('open'));
      },

      setView(mode) {
        this.state.view = mode;
        if(this.state.arData) this.renderVerses(this.state.arData, {ayahs:[]}); // Refresh view
      },

      updateFont(f) { document.documentElement.style.setProperty('--font-ar', f); },
      stepVerse(d) {
        const n = this.state.curIdx + d;
        if(this.state.arData?.ayahs[n]) this.prepVerse(this.state.arData.ayahs[n].number, n);
      }
    };
    window.onload = () => Sanctuary.init();
  </script>
</body>
</html>
