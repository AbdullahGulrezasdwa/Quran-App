<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quran Sanctuary | v12 Glass Edition</title>
    
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --p: #2ca4ab;
            --glass: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(255, 255, 255, 0.4);
            --bg-gradient: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%);
            --text: #1f2937;
            --card-radius: 28px;
        }

        body.dark {
            --glass: rgba(15, 23, 42, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
            --bg-gradient: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            --text: #f8fafc;
        }

        * { box-sizing: border-box; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        
        body { 
            margin: 0; font-family: 'Plus Jakarta Sans', sans-serif; 
            background: var(--bg-gradient); color: var(--text); 
            height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }

        /* Glassmorphism Logic */
        .glass-panel {
            background: var(--glass);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            border-radius: var(--card-radius);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }

        /* Layout */
        header {
            height: 80px; display: flex; align-items: center; justify-content: space-between;
            padding: 0 40px; margin: 15px;
        }

        main { display: flex; flex: 1; gap: 20px; padding: 0 20px 20px 20px; overflow: hidden; }

        aside {
            width: 340px; display: flex; flex-direction: column; gap: 15px;
        }

        .search-box {
            padding: 15px 25px; font-size: 1rem; border: none; outline: none;
            width: 100%; color: var(--text);
        }

        .surah-list { 
            flex: 1; overflow-y: auto; padding: 10px;
            scrollbar-width: none;
        }

        .surah-item {
            padding: 16px 20px; margin-bottom: 10px; border-radius: 20px;
            display: flex; justify-content: space-between; align-items: center;
            cursor: pointer; background: transparent;
        }
        .surah-item:hover, .surah-item.active {
            background: var(--p); color: white; transform: scale(1.02);
            box-shadow: 0 10px 20px rgba(44, 164, 171, 0.3);
        }
        .surah-item .ar { font-family: 'Amiri'; font-size: 1.4rem; }

        /* Content Area */
        #viewport { 
            flex: 1; overflow-y: auto; padding: 30px; 
            scrollbar-width: thin;
        }
        .ayah-card {
            padding: 35px; margin-bottom: 25px; border-radius: var(--card-radius);
            background: var(--glass); border: 1px solid var(--glass-border);
        }
        .ayah-card:hover { border-color: var(--p); transform: translateY(-3px); }

        .q-text { 
            font-family: 'Amiri'; font-size: 3rem; line-height: 2; 
            direction: rtl; text-align: right; margin-bottom: 20px;
        }
        .translation { font-size: 1.15rem; line-height: 1.8; opacity: 0.8; font-weight: 300; }

        /* Floating Player */
        .player-wrap {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 900px; padding: 15px 40px;
            display: flex; align-items: center; justify-content: space-between;
            z-index: 1000;
        }
        .play-btn {
            width: 60px; height: 60px; border-radius: 50%; background: var(--p);
            color: white; border: none; cursor: pointer; display: flex;
            align-items: center; justify-content: center; box-shadow: 0 8px 15px rgba(44, 164, 171, 0.4);
        }
        .play-btn:hover { transform: scale(1.1); }

        /* Settings Drawer */
        #drawer {
            position: fixed; top: 20px; right: -400px; width: 360px; height: calc(100% - 40px);
            z-index: 2001; padding: 40px; display: flex; flex-direction: column; gap: 30px;
        }
        #drawer.open { right: 20px; }

        .btn-icon {
            width: 45px; height: 45px; display: flex; align-items: center; justify-content: center;
            border-radius: 15px; cursor: pointer; border: 1px solid var(--glass-border);
            background: var(--glass); color: var(--text);
        }
        .btn-icon:hover { background: var(--p); color: white; }

    </style>
</head>
<body class="dark">

    <header class="glass-panel">
        <div style="display:flex; align-items:center; gap:12px; font-weight:800; color:var(--p); font-size:1.4rem;">
            <i data-lucide="sparkles"></i> SANCTUARY <span style="font-weight: 300; opacity: 0.5;">GLASS</span>
        </div>
        <div style="display:flex; gap:15px;">
            <div class="btn-icon" onclick="App.ui.toggleTheme()"><i data-lucide="sun" id="t-icon"></i></div>
            <div class="btn-icon" onclick="App.ui.toggleMenu()"><i data-lucide="settings"></i></div>
        </div>
    </header>

    <main>
        <aside>
            <div class="glass-panel" style="overflow:hidden;">
                <input type="text" class="search-box" placeholder="Search Surah..." oninput="App.ui.filter(this.value)">
            </div>
            <div class="glass-panel surah-list" id="surah-target"></div>
        </aside>

        <section id="viewport" class="glass-panel">
            <div id="reader-target">
                <div style="text-align:center; margin-top:150px; opacity:0.3;">
                    <i data-lucide="wind" style="width:100px; height:100px;"></i>
                    <h2>Select a Chapter</h2>
                </div>
            </div>
        </section>
    </main>

    <div class="glass-panel player-wrap">
        <div style="width: 200px;">
            <b id="np-name" style="color: var(--p);">Ready</b>
            <div style="font-size:0.7rem; opacity:0.6;">Alafasy Recitation</div>
        </div>
        <div style="display:flex; align-items:center; gap:25px;">
            <i data-lucide="skip-back" style="cursor:pointer;" onclick="App.audio.skip(-1)"></i>
            <button class="play-btn" onclick="App.audio.toggle()"><i data-lucide="play" id="p-icon"></i></button>
            <i data-lucide="skip-forward" style="cursor:pointer;" onclick="App.audio.skip(1)"></i>
        </div>
        <div style="width:200px; text-align:right; font-size:0.8rem; opacity:0.6;">
            128kbps / HD Audio
        </div>
    </div>

    <div class="glass-panel" id="drawer">
        <div style="display:flex; justify-content:space-between;">
            <h3>Sanctuary Settings</h3>
            <div class="btn-icon" onclick="App.ui.toggleMenu()"><i data-lucide="x"></i></div>
        </div>
        <div>
            <label style="display:block; margin-bottom:10px;">Arabic Size</label>
            <input type="range" min="2" max="5" step="0.1" value="3" style="width:100%" oninput="document.documentElement.style.setProperty('--ar-size', this.value+'rem')">
        </div>
        <div id="bm-list">
            <h4>Saved Verses</h4>
            <div id="bm-target" style="opacity:0.6;">No saves yet.</div>
        </div>
    </div>

    <audio id="core-audio"></audio>

    <script>
        const App = {
            state: { chapters: [], currentId: 0, isDark: true, bookmarks: [] },

            async init() {
                const res = await fetch('https://api.alquran.cloud/v1/surah');
                const json = await res.json();
                this.state.chapters = json.data;
                this.ui.renderList(this.state.chapters);
                lucide.createIcons();
            },

            ui: {
                renderList(data) {
                    document.getElementById('surah-target').innerHTML = data.map(s => `
                        <div class="surah-item" id="s-${s.number}" onclick="App.logic.load(${s.number})">
                            <div><span style="opacity:0.4; font-size:0.8rem;">${s.number}</span> <b>${s.englishName}</b></div>
                            <div class="ar">${s.name.replace('سُورَةُ', '')}</div>
                        </div>
                    `).join('');
                },
                toggleMenu() { document.getElementById('drawer').classList.toggle('open'); },
                toggleTheme() {
                    App.state.isDark = !App.state.isDark;
                    document.body.className = App.state.isDark ? 'dark' : '';
                    document.getElementById('t-icon').setAttribute('data-lucide', App.state.isDark ? 'sun' : 'moon');
                    lucide.createIcons();
                },
                filter(q) {
                    const f = App.state.chapters.filter(c => c.englishName.toLowerCase().includes(q.toLowerCase()));
                    this.renderList(f);
                }
            },

            logic: {
                async load(id) {
                    App.state.currentId = id;
                    document.querySelectorAll('.surah-item').forEach(i => i.classList.remove('active'));
                    document.getElementById(`s-${id}`).classList.add('active');

                    const [ar, en] = await Promise.all([
                        fetch(`https://api.alquran.cloud/v1/surah/${id}/quran-uthmani`).then(r => r.json()),
                        fetch(`https://api.alquran.cloud/v1/surah/${id}/en.sahih`).then(r => r.json())
                    ]);

                    document.getElementById('np-name').innerText = ar.data.englishName;
                    document.getElementById('core-audio').src = `https://cdn.islamic.network/quran/audio-surah/128/ar.alafasy/${id}.mp3`;

                    let h = `<div style="text-align:center; padding:40px 0;"><h1 style="font-family:'Amiri'; font-size:5rem; color:var(--p);">${ar.data.name}</h1></div>`;
                    if(id != 1 && id != 9) h += `<div style="text-align:center; font-family:'Amiri'; font-size:2.8rem; margin-bottom:50px; opacity:0.7;">بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ</div>`;

                    h += ar.data.ayahs.map((v, i) => `
                        <div class="ayah-card">
                            <div class="q-text" style="font-size: var(--ar-size)">${(id!=1 && id!=9 && i==0) ? v.text.replace("بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ", "") : v.text}</div>
                            <div class="translation">${en.data.ayahs[i].text}</div>
                            <div style="margin-top:25px; display:flex; gap:20px; font-size:0.8rem; color:var(--p);">
                                <b>${id}:${v.numberInSurah}</b>
                                <i data-lucide="play" style="width:16px; cursor:pointer;" onclick="App.audio.playAyah(${v.number})"></i>
                                <i data-lucide="bookmark" style="width:16px; cursor:pointer;"></i>
                            </div>
                        </div>
                    `).join('');

                    document.getElementById('reader-target').innerHTML = h;
                    document.getElementById('viewport').scrollTop = 0;
                    lucide.createIcons();
                }
            },

            audio: {
                toggle() {
                    const a = document.getElementById('core-audio');
                    if (a.paused) { a.play(); document.getElementById('p-icon').setAttribute('data-lucide', 'pause'); }
                    else { a.pause(); document.getElementById('p-icon').setAttribute('data-lucide', 'play'); }
                    lucide.createIcons();
                },
                playAyah(n) {
                    const a = document.getElementById('core-audio');
                    a.src = `https://cdn.islamic.network/quran/audio/128/ar.alafasy/${n}.mp3`;
                    a.play();
                    document.getElementById('p-icon').setAttribute('data-lucide', 'pause');
                    lucide.createIcons();
                },
                skip(d) { App.logic.load(App.state.currentId + d); }
            }
        };

        window.onload = () => App.init();
    </script>
</body>
</html>
