<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zenith Active Logic</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=Amiri+Quran&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #010409; --card: #0d1117; --accent: #38bdf8; --border: rgba(255,255,255,0.1);
            --text: #f0f6fc; --text-dim: #8b949e;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: var(--bg); color: var(--text); 
            display: flex; height: 100vh; overflow: hidden; 
        }

        /* ANIMATIONS */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate { animation: fadeIn 0.5s ease forwards; }

        /* SIDEBAR */
        nav { 
            width: 320px; background: var(--card); border-right: 1px solid var(--border); 
            display: flex; flex-direction: column; padding: 30px; z-index: 1000; 
        }
        .nav-btn { 
            width: 100%; padding: 14px 18px; border-radius: 12px; display: flex; align-items: center; gap: 12px; 
            color: var(--text-dim); cursor: pointer; border: 1px solid transparent; background: transparent; 
            margin-bottom: 8px; font-weight: 600; text-align: left; transition: 0.2s;
        }
        .nav-btn:hover { background: rgba(56, 189, 248, 0.1); color: var(--accent); }
        .nav-btn.active { background: rgba(56, 189, 248, 0.15); color: var(--accent); border-left: 4px solid var(--accent); }

        /* MAIN AREA */
        main { flex: 1; overflow-y: auto; padding-bottom: 120px; position: relative; }
        .container { max-width: 900px; margin: 0 auto; padding: 80px 40px; }

        /* VERSE BOXES - LEFT ALIGN */
        .verse-box { 
            background: rgba(255,255,255,0.02); border: 1px solid var(--border);
            padding: 40px; border-radius: 20px; margin-bottom: 25px;
            display: flex; flex-direction: column; align-items: flex-start;
        }
        .ar-text { 
            font-family: 'Amiri Quran'; font-size: 2.8rem; line-height: 1.8; 
            text-align: left; direction: rtl; width: 100%; margin-bottom: 20px;
        }
        .en-text { color: var(--text-dim); line-height: 1.6; font-size: 1.1rem; text-align: left; }

        /* ACTION BUTTONS */
        .action-row { display: flex; gap: 10px; margin-top: 25px; flex-wrap: wrap; }
        .btn-action { 
            padding: 8px 16px; border-radius: 8px; border: 1px solid var(--border);
            background: rgba(255,255,255,0.03); color: var(--text-dim); cursor: pointer;
            font-size: 0.75rem; font-weight: 700; display: flex; align-items: center; gap: 6px;
        }
        .btn-action:hover { border-color: var(--accent); color: var(--accent); }

        /* HUD */
        .hud { 
            position: fixed; bottom: 25px; left: 345px; right: 25px; 
            background: rgba(13, 17, 23, 0.9); backdrop-filter: blur(20px);
            border-radius: 20px; padding: 20px 30px; display: flex; align-items: center; gap: 20px;
            border: 1px solid var(--border); z-index: 2000;
        }
        .master-play { 
            background: var(--accent); color: #000; width: 45px; height: 45px; 
            border-radius: 50%; display: grid; place-items: center; cursor: pointer;
        }
    </style>
</head>
<body>

<nav>
    <div style="font-size: 1.5rem; font-weight: 900; color: var(--accent); margin-bottom: 40px;">ZENITH PRO</div>
    
    <button class="nav-btn active" id="btn-dash"><i data-lucide="layout"></i> Dashboard</button>
    <button class="nav-btn" id="btn-read"><i data-lucide="book-open"></i> Reading Mode</button>
    <button class="nav-btn" id="btn-favs"><i data-lucide="heart"></i> Favorites</button>
    
    <div style="margin: 20px 0; border-top: 1px solid var(--border);"></div>
    
    <button class="nav-btn"><i data-lucide="mic-2"></i> Reciters</button>
    <button class="nav-btn"><i data-lucide="languages"></i> Translations</button>
    <button class="nav-btn" id="btn-settings"><i data-lucide="settings"></i> Settings</button>
    <button class="nav-btn" style="color: #f87171" onclick="location.reload()"><i data-lucide="refresh-cw"></i> Reset</button>
</nav>

<main id="scroller">
    <div class="container" id="view"></div>
</main>

<div class="hud">
    <div class="master-play" id="master-play-btn"><i data-lucide="play"></i></div>
    <div style="flex:1">
        <div id="p-meta" style="font-size:0.75rem; font-weight:800; color:var(--accent); margin-bottom:8px">IDLE</div>
        <div style="height:4px; background:rgba(255,255,255,0.05); border-radius:10px; overflow:hidden">
            <div id="p-fill" style="height:100%; width:0%; background:var(--accent)"></div>
        </div>
    </div>
</div>

<audio id="main-audio"></audio>

<script>
// Use a direct object-based architecture to prevent scope issues
const App = {
    state: { surahs: [], activeSurah: null },
    audio: document.getElementById('main-audio'),

    async init() {
        try {
            const res = await fetch('https://api.alquran.cloud/v1/surah');
            const data = await res.json();
            this.state.surahs = data.data;
            this.renderDashboard();
            this.setupListeners();
            lucide.createIcons();
        } catch (e) {
            console.error("Failed to initialize", e);
        }
    },

    setupListeners() {
        document.getElementById('btn-dash').addEventListener('click', () => this.renderDashboard());
        document.getElementById('master-play-btn').addEventListener('click', () => this.togglePlay());
        
        this.audio.ontimeupdate = () => {
            const progress = (this.audio.currentTime / this.audio.duration) * 100;
            document.getElementById('p-fill').style.width = progress + '%';
        };
    },

    renderDashboard() {
        const view = document.getElementById('view');
        view.innerHTML = `
            <h1 class="animate" style="font-size: 3rem; margin-bottom: 40px;">The Library</h1>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px;">
                ${this.state.surahs.map(s => `
                    <div class="verse-box animate" style="padding: 25px; cursor: pointer;" onclick="App.loadSurah(${s.number})">
                        <span style="color: var(--accent); font-size: 0.7rem; font-weight: 800;">SURAH ${s.number}</span>
                        <h2 style="margin: 10px 0;">${s.englishName}</h2>
                        <div style="font-family: 'Amiri Quran'; text-align: right; color: var(--accent); font-size: 1.8rem;">${s.name}</div>
                    </div>
                `).join('')}
            </div>
        `;
        lucide.createIcons();
    },

    async loadSurah(num) {
        const [arRes, enRes] = await Promise.all([
            fetch(`https://api.alquran.cloud/v1/surah/${num}/quran-uthmani`),
            fetch(`https://api.alquran.cloud/v1/surah/${num}/en.sahih`)
        ]);
        const ar = await arRes.json();
        const en = await enRes.json();
        
        let ayahs = ar.data.ayahs;
        const isNormalSurah = (num !== 1 && num !== 9);
        
        let html = `
            <div class="animate">
                <button class="btn-action" onclick="App.renderDashboard()" style="margin-bottom: 30px;">← Back</button>
                <div style="text-align: center; margin-bottom: 60px;">
                    <h1 style="font-family: 'Amiri Quran'; font-size: 5rem; color: var(--accent);">${ar.data.name}</h1>
                    ${isNormalSurah ? `<div style="font-family: 'Amiri Quran'; font-size: 2.5rem; opacity: 0.6; margin-top: 20px;">بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ</div>` : ''}
                </div>
            </div>
        `;

        ayahs.forEach((v, i) => {
            let cleanText = v.text;
            if (isNormalSurah && i === 0) {
                cleanText = cleanText.replace("بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ ", "");
            }

            html += `
                <div class="verse-box animate">
                    <div class="v-num">VERSE ${i+1}</div>
                    <p class="ar-text">${cleanText}</p>
                    <p class="en-text">${en.data.ayahs[i].text}</p>
                    <div class="action-row">
                        <button class="btn-action" onclick="App.playAyah(${v.number}, ${i+1})"><i data-lucide="play"></i> Play</button>
                        <button class="btn-action" onclick="this.nextElementSibling.style.display='block'"><i data-lucide="book"></i> Tafsir</button>
                        <div style="display:none; width:100%; margin-top:15px; color:var(--accent); font-size:0.9rem;">Reflection: Study the linguistic depth of this verse.</div>
                        <button class="btn-action"><i data-lucide="heart"></i> Save</button>
                        <button class="btn-action"><i data-lucide="share"></i> Share</button>
                        <button class="btn-action"><i data-lucide="copy"></i> Copy</button>
                    </div>
                </div>
            `;
        });

        document.getElementById('view').innerHTML = html;
        document.getElementById('scroller').scrollTop = 0;
        lucide.createIcons();
    },

    playAyah(num, idx) {
        this.audio.src = `https://cdn.islamic.network/quran/audio/128/ar.alafasy/${num}.mp3`;
        this.audio.play();
        document.getElementById('p-meta').innerText = `VERSE ${idx}`;
        const icon = document.querySelector('#master-play-btn i');
        icon.setAttribute('data-lucide', 'pause');
        lucide.createIcons();
    },

    togglePlay() {
        if (!this.audio.src) return;
        if (this.audio.paused) {
            this.audio.play();
        } else {
            this.audio.pause();
        }
        const icon = document.querySelector('#master-play-btn i');
        icon.setAttribute('data-lucide', this.audio.paused ? 'play' : 'pause');
        lucide.createIcons();
    }
};

// Start the app
App.init();
</script>
</body>
</html>
