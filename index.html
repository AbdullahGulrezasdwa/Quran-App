<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zenith Pro | Premium Quran Experience</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,400&family=Amiri+Quran&family=Noto+Serif:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #080c10;
            --sidebar: #05080b;
            --card: #0e1318;
            --card-hover: #131920;
            --accent: #38bdf8;
            --accent-gold: #f4c84a;
            --accent-glow: rgba(56,189,248,0.12);
            --accent-glow-strong: rgba(56,189,248,0.25);
            --gold-glow: rgba(244,200,74,0.12);
            --border: #1e2730;
            --border-bright: #2d3f50;
            --text-main: #dde6ef;
            --text-dim: #6b7f8f;
            --text-dimmer: #3d5060;
            --glass: rgba(8,12,16,0.85);
            --sidebar-w: 300px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--border-bright); }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--bg);
            color: var(--text-main);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* ‚îÄ‚îÄ‚îÄ‚îÄ NOISE OVERLAY ‚îÄ‚îÄ‚îÄ‚îÄ */
        body::before {
            content: '';
            position: fixed; inset: 0; z-index: 0; pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
            opacity: 0.4;
        }

        /* ‚îÄ‚îÄ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ‚îÄ‚îÄ */
        nav {
            width: var(--sidebar-w);
            background: var(--sidebar);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            z-index: 100;
            position: relative;
        }

        .nav-header {
            padding: 24px 22px 20px;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            font-size: 1.1rem;
            font-weight: 800;
            letter-spacing: 0.12em;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .logo-icon {
            width: 34px; height: 34px;
            background: var(--accent-glow);
            border: 1px solid rgba(56,189,248,0.25);
            border-radius: 10px;
            display: grid; place-items: center;
        }

        .nav-tabs {
            display: flex;
            padding: 12px 14px;
            gap: 6px;
            border-bottom: 1px solid var(--border);
        }
        .nav-tab {
            flex: 1; padding: 7px 0; font-size: 0.72rem; font-weight: 700;
            letter-spacing: 0.06em; border: 1px solid transparent;
            border-radius: 8px; cursor: pointer; background: transparent;
            color: var(--text-dim); transition: all 0.2s;
        }
        .nav-tab.active { background: var(--accent-glow); border-color: rgba(56,189,248,0.25); color: var(--accent); }
        .nav-tab:hover:not(.active) { color: var(--text-main); }

        .search-container { padding: 14px; }
        .search-wrap { position: relative; }
        .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-dim); pointer-events: none; }
        .search-bar {
            width: 100%;
            background: var(--card);
            border: 1px solid var(--border);
            padding: 10px 12px 10px 36px;
            border-radius: 10px;
            color: var(--text-main);
            font-family: inherit;
            font-size: 0.85rem;
            outline: none;
            transition: border-color 0.2s;
        }
        .search-bar:focus { border-color: rgba(56,189,248,0.4); }
        .search-bar::placeholder { color: var(--text-dim); }

        .nav-scroll { flex: 1; overflow-y: auto; padding: 8px; }

        .surah-item {
            padding: 10px 12px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 2px;
            border: 1px solid transparent;
            transition: all 0.18s;
            position: relative;
        }
        .surah-item:hover { background: rgba(255,255,255,0.03); }
        .surah-item.active {
            background: var(--accent-glow);
            border-color: rgba(56,189,248,0.22);
        }
        .surah-item.active::before {
            content: '';
            position: absolute; left: 0; top: 15%; bottom: 15%;
            width: 2px; background: var(--accent);
            border-radius: 4px;
        }
        .surah-num {
            width: 32px; height: 32px; min-width: 32px;
            border: 1px solid var(--border);
            border-radius: 8px; display: grid; place-items: center;
            font-size: 0.68rem; font-weight: 700; color: var(--text-dim);
            transition: all 0.2s;
        }
        .surah-item.active .surah-num,
        .surah-item:hover .surah-num { border-color: var(--accent); color: var(--accent); background: var(--accent-glow); }
        .surah-meta { flex: 1; min-width: 0; }
        .surah-name { font-weight: 700; font-size: 0.85rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .surah-sub { font-size: 0.68rem; color: var(--text-dim); margin-top: 2px; }
        .surah-ar { font-family: 'Amiri Quran', serif; font-size: 1.1rem; color: var(--accent); opacity: 0.7; }

        /* Bookmarks panel */
        #bookmarks-panel { display: none; padding: 8px; }
        #bookmarks-panel.visible { display: block; }
        .bookmark-item {
            padding: 10px 12px; border-radius: 10px;
            border: 1px solid var(--border); margin-bottom: 6px;
            cursor: pointer; transition: all 0.15s;
            display: flex; align-items: center; justify-content: space-between;
        }
        .bookmark-item:hover { border-color: var(--accent-gold); background: var(--gold-glow); }
        .bm-label { font-size: 0.78rem; font-weight: 600; }
        .bm-sub { font-size: 0.68rem; color: var(--text-dim); margin-top: 2px; }
        .bm-del { background: transparent; border: none; color: var(--text-dim); cursor: pointer; padding: 4px; border-radius: 4px; }
        .bm-del:hover { color: #ef4444; }
        .empty-state { text-align: center; padding: 40px 20px; color: var(--text-dim); font-size: 0.82rem; }

        /* Last read banner */
        .last-read-pill {
            margin: 0 14px 10px;
            padding: 10px 14px;
            background: var(--gold-glow);
            border: 1px solid rgba(244,200,74,0.2);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            display: none;
        }
        .last-read-pill.visible { display: block; }
        .last-read-pill:hover { border-color: rgba(244,200,74,0.4); }
        .lrp-label { font-size: 0.65rem; font-weight: 700; letter-spacing: 0.08em; color: var(--accent-gold); }
        .lrp-val { font-size: 0.8rem; font-weight: 600; margin-top: 2px; }

        /* ‚îÄ‚îÄ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ‚îÄ‚îÄ */
        main { flex: 1; overflow-y: auto; position: relative; scroll-behavior: smooth; }

        /* Hero */
        .hero {
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            position: relative; padding: 60px 40px;
            text-align: center;
        }
        .hero-bg {
            position: absolute; inset: 0; overflow: hidden; z-index: 0;
        }
        .hero-orb {
            position: absolute; border-radius: 50%;
            filter: blur(80px); pointer-events: none;
        }
        .hero-orb-1 { width: 500px; height: 500px; background: rgba(56,189,248,0.06); top: -100px; left: 50%; transform: translateX(-50%); }
        .hero-orb-2 { width: 300px; height: 300px; background: rgba(244,200,74,0.04); bottom: 100px; right: 10%; }

        .hero-content { position: relative; z-index: 1; }
        .hero-eyebrow { font-size: 0.7rem; font-weight: 700; letter-spacing: 0.2em; color: var(--accent); margin-bottom: 20px; opacity: 0; animation: fadeUp 0.8s 0.2s forwards; }
        .hero-title { font-family: 'Amiri Quran', serif; font-size: clamp(3rem, 8vw, 6rem); color: var(--text-main); line-height: 1.2; margin-bottom: 16px; opacity: 0; animation: fadeUp 0.8s 0.35s forwards; }
        .hero-sub { font-size: 1rem; color: var(--text-dim); max-width: 380px; margin: 0 auto 40px; opacity: 0; animation: fadeUp 0.8s 0.5s forwards; }

        .votd-card {
            max-width: 520px; margin: 0 auto;
            background: rgba(14,19,24,0.7);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 20px; padding: 28px 32px;
            text-align: right;
            opacity: 0; animation: fadeUp 0.8s 0.65s forwards;
            position: relative; overflow: hidden;
        }
        .votd-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, transparent, var(--accent), transparent); }
        .votd-label { font-size: 0.65rem; font-weight: 700; letter-spacing: 0.12em; color: var(--accent-gold); text-transform: uppercase; text-align: left; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
        .votd-label::after { content: ''; flex: 1; height: 1px; background: var(--border); }
        .votd-ar { font-family: 'Amiri Quran', serif; font-size: 1.7rem; line-height: 2.2; color: var(--text-main); margin-bottom: 12px; }
        .votd-en { font-family: 'Noto Serif', serif; font-style: italic; font-size: 0.88rem; color: var(--text-dim); line-height: 1.7; text-align: left; }
        .votd-ref { font-size: 0.7rem; color: var(--text-dimmer); text-align: left; margin-top: 12px; font-weight: 600; letter-spacing: 0.06em; }

        /* Content */
        .content-container { max-width: 800px; margin: 0 auto; padding: 40px 24px 160px; }

        .surah-header {
            text-align: center; margin-bottom: 50px; padding: 40px 30px;
            background: var(--card); border: 1px solid var(--border); border-radius: 24px;
            position: relative; overflow: hidden;
        }
        .surah-header::after { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, transparent, var(--accent), var(--accent-gold), var(--accent), transparent); }
        .sh-ar { font-family: 'Amiri Quran', serif; font-size: clamp(2.5rem, 6vw, 4.5rem); color: var(--accent); margin-bottom: 8px; }
        .sh-en { font-size: 1rem; color: var(--text-dim); }
        .sh-badges { display: flex; gap: 8px; justify-content: center; margin-top: 16px; }
        .badge {
            padding: 4px 12px; border-radius: 100px; font-size: 0.68rem; font-weight: 700; letter-spacing: 0.06em;
            border: 1px solid; text-transform: uppercase;
        }
        .badge-blue { border-color: rgba(56,189,248,0.3); color: var(--accent); background: var(--accent-glow); }
        .badge-gold { border-color: rgba(244,200,74,0.3); color: var(--accent-gold); background: var(--gold-glow); }

        .bismillah {
            text-align: center; font-family: 'Amiri Quran', serif;
            font-size: 2rem; color: var(--accent-gold); margin-bottom: 40px;
            opacity: 0.85;
        }

        /* Ayah cards */
        .ayah-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 28px 30px;
            margin-bottom: 20px;
            transition: border-color 0.25s, transform 0.25s;
            position: relative; overflow: hidden;
            animation: fadeUp 0.4s both;
        }
        .ayah-card:hover { border-color: var(--border-bright); }
        .ayah-card.playing {
            border-color: rgba(56,189,248,0.4);
            background: linear-gradient(135deg, var(--card) 0%, rgba(56,189,248,0.04) 100%);
        }
        .ayah-card.playing::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 3px; background: var(--accent); border-radius: 4px 0 0 4px; }
        .ayah-card.bookmarked::after { content: ''; position: absolute; right: 0; top: 0; bottom: 0; width: 2px; background: var(--accent-gold); border-radius: 0 4px 4px 0; }

        .ayah-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
        .ayah-num-badge {
            font-size: 0.65rem; font-weight: 800; letter-spacing: 0.1em;
            padding: 4px 10px; border-radius: 6px;
            background: var(--accent-glow); color: var(--accent);
            border: 1px solid rgba(56,189,248,0.2);
        }
        .ayah-actions { display: flex; gap: 6px; }
        .action-btn {
            background: transparent; border: 1px solid var(--border);
            color: var(--text-dim); width: 30px; height: 30px; border-radius: 8px;
            display: grid; place-items: center; cursor: pointer;
            transition: all 0.15s; font-size: 0;
        }
        .action-btn:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-glow); }
        .action-btn.bookmarked-btn { border-color: rgba(244,200,74,0.4); color: var(--accent-gold); background: var(--gold-glow); }

        .ar {
            font-family: 'Amiri Quran', serif;
            font-size: 2rem; direction: rtl;
            line-height: 2.3; margin: 0 0 16px;
            color: var(--text-main);
        }
        .en {
            font-family: 'Noto Serif', serif;
            font-style: italic;
            color: var(--text-dim); font-size: 1rem; line-height: 1.75;
        }

        .ayah-footer { display: flex; gap: 8px; margin-top: 18px; flex-wrap: wrap; }
        .btn-mini {
            display: inline-flex; align-items: center; gap: 5px;
            background: transparent; border: 1px solid var(--border);
            color: var(--text-dim); padding: 6px 13px; border-radius: 8px;
            font-size: 0.72rem; font-weight: 600; cursor: pointer;
            transition: all 0.15s; font-family: inherit;
        }
        .btn-mini:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-glow); }
        .btn-mini.active { border-color: rgba(244,200,74,0.4); color: var(--accent-gold); background: var(--gold-glow); }

        .tafsir-box {
            margin-top: 18px;
            padding: 18px 20px;
            background: rgba(0,0,0,0.25);
            border-radius: 12px; display: none;
            border-left: 2px solid var(--accent);
            font-size: 0.88rem; line-height: 1.75; color: var(--text-dim);
        }
        .tafsir-box.open { display: block; animation: fadeDown 0.25s ease; }
        .tafsir-loader { display: flex; align-items: center; gap: 8px; color: var(--text-dimmer); font-size: 0.8rem; }
        .tafsir-spinner { width: 14px; height: 14px; border: 2px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.6s linear infinite; }

        /* Divider */
        .surah-divider { display: flex; align-items: center; gap: 16px; margin: 30px 0; color: var(--text-dimmer); font-size: 0.7rem; font-weight: 700; letter-spacing: 0.1em; }
        .surah-divider::before, .surah-divider::after { content: ''; flex: 1; height: 1px; background: var(--border); }

        /* ‚îÄ‚îÄ‚îÄ‚îÄ PLAYER HUD ‚îÄ‚îÄ‚îÄ‚îÄ */
        .player-hud {
            position: fixed; bottom: 24px;
            left: calc(var(--sidebar-w) + 20px); right: 20px;
            background: rgba(5,8,11,0.92);
            backdrop-filter: blur(20px) saturate(1.5);
            border: 1px solid var(--border-bright);
            border-radius: 20px;
            padding: 14px 20px;
            display: flex; align-items: center; gap: 16px;
            box-shadow: 0 8px 40px rgba(0,0,0,0.6), 0 0 0 0.5px rgba(56,189,248,0.08);
            z-index: 200;
        }

        .hud-artwork {
            width: 42px; height: 42px; min-width: 42px;
            background: var(--accent-glow); border: 1px solid rgba(56,189,248,0.2);
            border-radius: 12px; display: grid; place-items: center;
            font-family: 'Amiri Quran', serif; font-size: 1.1rem; color: var(--accent);
        }

        .hud-center { flex: 1; min-width: 0; }
        .hud-track { display: flex; justify-content: space-between; margin-bottom: 6px; align-items: center; }
        .hud-title { font-size: 0.72rem; font-weight: 800; letter-spacing: 0.06em; color: var(--accent); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 300px; }
        .hud-time { font-size: 0.65rem; color: var(--text-dim); font-weight: 600; flex-shrink: 0; }

        .progress-bg {
            height: 4px; background: rgba(255,255,255,0.07);
            border-radius: 10px; cursor: pointer; position: relative;
        }
        .progress-bg:hover { height: 6px; margin: -1px 0; }
        .progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent), var(--accent-gold)); border-radius: 10px; transition: width 0.1s linear; pointer-events: none; position: relative; }
        .progress-bar::after { content: ''; position: absolute; right: -4px; top: -3px; width: 10px; height: 10px; background: white; border-radius: 50%; opacity: 0; transition: opacity 0.15s; }
        .progress-bg:hover .progress-bar::after { opacity: 1; }

        .hud-controls { display: flex; align-items: center; gap: 8px; }

        .hud-btn {
            background: transparent; border: none; color: var(--text-dim);
            width: 34px; height: 34px; border-radius: 10px;
            display: grid; place-items: center; cursor: pointer; transition: all 0.15s;
        }
        .hud-btn:hover { color: var(--text-main); background: rgba(255,255,255,0.05); }
        .hud-btn.active { color: var(--accent); }

        .play-btn {
            width: 42px; height: 42px; min-width: 42px;
            background: var(--accent); border: none;
            border-radius: 12px; cursor: pointer;
            display: grid; place-items: center; color: #05080b;
            transition: all 0.15s;
        }
        .play-btn:hover { transform: scale(1.05); background: #7dd3fc; }
        .play-btn:active { transform: scale(0.96); }

        .hud-extras { display: flex; align-items: center; gap: 6px; }
        .speed-btn {
            background: var(--accent-glow); border: 1px solid rgba(56,189,248,0.2);
            color: var(--accent); padding: 4px 9px; border-radius: 7px;
            font-size: 0.68rem; font-weight: 800; cursor: pointer; letter-spacing: 0.04em;
            transition: all 0.15s;
        }
        .speed-btn:hover { background: var(--accent-glow-strong); }
        .vol-wrap { display: flex; align-items: center; gap: 8px; }
        .vol-slider {
            -webkit-appearance: none; width: 70px; height: 3px;
            background: var(--border); border-radius: 10px; cursor: pointer; outline: none;
        }
        .vol-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 12px; height: 12px; background: var(--accent); border-radius: 50%; }

        /* Waveform bars */
        .waveform { display: flex; align-items: center; gap: 2px; height: 24px; margin-right: 4px; }
        .wave-bar {
            width: 3px; background: var(--accent); border-radius: 2px; opacity: 0.5;
            transition: height 0.1s;
        }
        .waveform.active .wave-bar { animation: wave 1s ease-in-out infinite alternate; opacity: 0.9; }
        .wave-bar:nth-child(1) { height: 6px; animation-delay: 0s; }
        .wave-bar:nth-child(2) { height: 12px; animation-delay: 0.15s; }
        .wave-bar:nth-child(3) { height: 18px; animation-delay: 0.05s; }
        .wave-bar:nth-child(4) { height: 10px; animation-delay: 0.2s; }
        .wave-bar:nth-child(5) { height: 16px; animation-delay: 0.1s; }
        .wave-bar:nth-child(6) { height: 8px; animation-delay: 0.25s; }

        /* Toast */
        .toast {
            position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%) translateY(20px);
            background: rgba(14,19,24,0.95); border: 1px solid var(--border-bright);
            color: var(--text-main); padding: 10px 18px; border-radius: 12px;
            font-size: 0.8rem; font-weight: 600; z-index: 9999;
            opacity: 0; transition: all 0.25s; pointer-events: none;
            display: flex; align-items: center; gap: 8px;
            backdrop-filter: blur(10px);
        }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

        /* Keyboard shortcut badge */
        .shortcut-tag { display: inline-block; padding: 1px 5px; background: var(--card); border: 1px solid var(--border); border-radius: 4px; font-size: 0.65rem; color: var(--text-dimmer); }

        /* Loading skeleton */
        .skeleton { background: linear-gradient(90deg, var(--card) 25%, var(--card-hover) 50%, var(--card) 75%); background-size: 200% 100%; animation: shimmer 1.4s infinite; border-radius: 8px; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

        /* Transitions */
        .fade-in { animation: fadeUp 0.4s ease both; }

        @keyframes fadeUp { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeDown { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes wave { from { transform: scaleY(0.4); } to { transform: scaleY(1); } }
        @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 0 0 var(--accent-glow); } 50% { box-shadow: 0 0 20px 4px var(--accent-glow); } }

        /* Hotkeys panel */
        .hotkeys-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px);
            z-index: 1000; display: none; align-items: center; justify-content: center;
        }
        .hotkeys-overlay.open { display: flex; animation: fadeUp 0.2s ease; }
        .hotkeys-modal {
            background: var(--card); border: 1px solid var(--border-bright);
            border-radius: 20px; padding: 32px; min-width: 340px;
        }
        .hk-title { font-size: 1rem; font-weight: 800; margin-bottom: 20px; color: var(--accent); }
        .hk-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid var(--border); font-size: 0.82rem; color: var(--text-dim); }
        .hk-row:last-child { border: none; }
        .hk-keys { display: flex; gap: 4px; }
        .hk-key { padding: 2px 8px; background: var(--bg); border: 1px solid var(--border); border-radius: 5px; font-size: 0.7rem; font-weight: 700; color: var(--text-main); }

        /* Stats bar */
        .stats-bar {
            display: flex; gap: 16px; flex-wrap: wrap;
            padding: 14px 16px; background: var(--gold-glow);
            border: 1px solid rgba(244,200,74,0.15); border-radius: 12px;
            margin: 0 14px 10px;
        }
        .stat-item { text-align: center; flex: 1; }
        .stat-num { font-size: 1.1rem; font-weight: 800; color: var(--accent-gold); }
        .stat-label { font-size: 0.6rem; color: var(--text-dim); font-weight: 600; letter-spacing: 0.05em; text-transform: uppercase; }
    </style>
</head>
<body>

<!-- Keyboard shortcut modal -->
<div class="hotkeys-overlay" id="hotkeys-overlay" onclick="if(event.target===this)this.classList.remove('open')">
    <div class="hotkeys-modal">
        <div class="hk-title">‚å® Keyboard Shortcuts</div>
        <div class="hk-row"><span>Play / Pause</span><div class="hk-keys"><span class="hk-key">Space</span></div></div>
        <div class="hk-row"><span>Previous Ayah</span><div class="hk-keys"><span class="hk-key">‚Üê</span></div></div>
        <div class="hk-row"><span>Next Ayah</span><div class="hk-keys"><span class="hk-key">‚Üí</span></div></div>
        <div class="hk-row"><span>Toggle Repeat</span><div class="hk-keys"><span class="hk-key">R</span></div></div>
        <div class="hk-row"><span>Toggle Autoplay</span><div class="hk-keys"><span class="hk-key">A</span></div></div>
        <div class="hk-row"><span>Volume Up/Down</span><div class="hk-keys"><span class="hk-key">‚Üë</span><span class="hk-key">‚Üì</span></div></div>
        <div class="hk-row"><span>This Help</span><div class="hk-keys"><span class="hk-key">?</span></div></div>
        <div class="hk-row"><span>Close</span><div class="hk-keys"><span class="hk-key">Esc</span></div></div>
    </div>
</div>

<div class="toast" id="toast"></div>

<nav>
    <div class="nav-header">
        <div class="logo">
            <div class="logo-icon"><i data-lucide="compass" style="width:16px;height:16px"></i></div>
            ZENITH PRO
        </div>
    </div>

    <div class="nav-tabs">
        <button class="nav-tab active" id="tab-surahs" onclick="App.switchTab('surahs')">Surahs</button>
        <button class="nav-tab" id="tab-bookmarks" onclick="App.switchTab('bookmarks')">Bookmarks</button>
        <button class="nav-tab" id="tab-stats" onclick="App.switchTab('stats')">Stats</button>
    </div>

    <div id="surahs-panel">
        <div class="search-container">
            <div class="search-wrap">
                <i data-lucide="search" class="search-icon" style="width:14px;height:14px"></i>
                <input type="text" class="search-bar" id="searchInp" placeholder="Search Surah..." oninput="App.filter(this.value)">
            </div>
        </div>
        <div class="last-read-pill" id="last-read-pill" onclick="App.resumeLastRead()">
            <div class="lrp-label">‚Ü© CONTINUE READING</div>
            <div class="lrp-val" id="last-read-val">‚Äî</div>
        </div>
        <div class="nav-scroll" id="surah-list"></div>
    </div>

    <div id="bookmarks-panel">
        <div class="nav-scroll" id="bookmarks-list" style="padding:8px"></div>
    </div>

    <div id="stats-panel" style="display:none; padding:12px">
        <div class="stats-bar" style="margin:0 0 10px; flex-direction:column; gap:10px">
            <div class="stat-item"><div class="stat-num" id="stat-listened">0</div><div class="stat-label">Ayahs Listened</div></div>
            <div class="stat-item"><div class="stat-num" id="stat-bookmarks">0</div><div class="stat-label">Bookmarks</div></div>
            <div class="stat-item"><div class="stat-num" id="stat-surahs">0</div><div class="stat-label">Surahs Visited</div></div>
        </div>
        <button class="btn-mini" style="width:100%; justify-content:center; margin-top:8px" onclick="App.resetStats()">
            <i data-lucide="refresh-cw" style="width:12px;height:12px"></i> Reset Stats
        </button>
    </div>
</nav>

<main id="scroller">
    <div id="view"></div>
</main>

<div class="player-hud">
    <div class="hud-artwork" id="hud-artwork">Ô∑Ω</div>

    <div class="waveform" id="waveform">
        <div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div>
        <div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div>
    </div>

    <div class="hud-center">
        <div class="hud-track">
            <span class="hud-title" id="now-playing">READY ‚Äî SELECT A SURAH</span>
            <span class="hud-time" id="time-display">00:00 / 00:00</span>
        </div>
        <div class="progress-bg" id="progress-bg">
            <div class="progress-bar" id="p-bar"></div>
        </div>
    </div>

    <div class="hud-controls">
        <button class="hud-btn" id="btn-prev" title="Previous Ayah"><i data-lucide="skip-back" style="width:16px;height:16px"></i></button>
        <button class="play-btn" id="masterPlay"><i data-lucide="play" style="width:18px;height:18px"></i></button>
        <button class="hud-btn" id="btn-next" title="Next Ayah"><i data-lucide="skip-forward" style="width:16px;height:16px"></i></button>
    </div>

    <div class="hud-extras">
        <button class="hud-btn" id="btn-repeat" title="Repeat Ayah"><i data-lucide="repeat-1" style="width:15px;height:15px"></i></button>
        <button class="hud-btn active" id="btn-auto" title="Auto-play Next"><i data-lucide="list-music" style="width:15px;height:15px"></i></button>
        <button class="speed-btn" id="speed-btn" title="Playback Speed">1√ó</button>
        <div class="vol-wrap">
            <i data-lucide="volume-2" style="width:14px;height:14px;color:var(--text-dim)"></i>
            <input type="range" class="vol-slider" id="vol-slider" min="0" max="1" step="0.05" value="1">
        </div>
        <button class="hud-btn" onclick="document.getElementById('hotkeys-overlay').classList.add('open')" title="Keyboard Shortcuts">
            <i data-lucide="keyboard" style="width:15px;height:15px"></i>
        </button>
    </div>
</div>

<audio id="player"></audio>

<script>
const TAFSIR_CACHE = {};
const SPEEDS = [0.75, 1, 1.25, 1.5, 2];

const App = {
    surahs: [],
    currentSurah: null,
    currentAyahs: [],
    currentAyahIdx: -1,
    audio: document.getElementById('player'),
    repeat: false,
    autoplay: true,
    speedIdx: 1,
    bookmarks: JSON.parse(localStorage.getItem('zp_bookmarks') || '[]'),
    stats: JSON.parse(localStorage.getItem('zp_stats') || '{"listened":0,"surahs":[]}'),
    lastRead: JSON.parse(localStorage.getItem('zp_lastread') || 'null'),
    votdData: null,

    async init() {
        try {
            const res = await fetch('https://api.alquran.cloud/v1/surah');
            const data = await res.json();
            this.surahs = data.data;
            this.renderSidebar(this.surahs);
            this.initAudioListeners();
            this.initProgressBar();
            this.initKeyboard();
            this.initVolume();
            this.updateStats();
            this.renderLastRead();
            await this.renderHero();
            lucide.createIcons();
        } catch (e) { console.error("Init failed", e); }
    },

    /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
    async renderHero() {
        const view = document.getElementById('view');
        const num = Math.floor(Math.random() * 6236) + 1;
        try {
            const [arR, enR] = await Promise.all([
                fetch(`https://api.alquran.cloud/v1/ayah/${num}/quran-uthmani`).then(r => r.json()),
                fetch(`https://api.alquran.cloud/v1/ayah/${num}/en.sahih`).then(r => r.json()),
            ]);
            const ar = arR.data; const en = enR.data;
            this.votdData = { ar, en, num };
            view.innerHTML = `
            <div class="hero">
                <div class="hero-bg">
                    <div class="hero-orb hero-orb-1"></div>
                    <div class="hero-orb hero-orb-2"></div>
                </div>
                <div class="hero-content">
                    <div class="hero-eyebrow">ZENITH PRO ¬∑ QURAN EXPERIENCE</div>
                    <h1 class="hero-title">ÿßŸÑŸÇÿ±ÿ¢ŸÜ ÿßŸÑŸÉÿ±ŸäŸÖ</h1>
                    <p class="hero-sub">Recite, listen, and reflect. Select a Surah from the sidebar to begin.</p>
                    <div class="votd-card">
                        <div class="votd-label">Verse of the Session</div>
                        <p class="votd-ar">${ar.text}</p>
                        <p class="votd-en">${en.text}</p>
                        <div class="votd-ref">${ar.surah.englishName} ¬∑ ${ar.surah.name} ‚Äî Ayah ${ar.numberInSurah}</div>
                        <button class="btn-mini" style="margin-top:16px" onclick="App.playAyah(${ar.number}, ${ar.numberInSurah})">
                            <i data-lucide="play" style="width:11px;height:11px"></i> Play this verse
                        </button>
                    </div>
                </div>
            </div>`;
        } catch {
            view.innerHTML = `<div class="hero"><div class="hero-content"><h1 class="hero-title">ÿßŸÑŸÇÿ±ÿ¢ŸÜ ÿßŸÑŸÉÿ±ŸäŸÖ</h1><p class="hero-sub">Select a Surah to begin your journey.</p></div></div>`;
        }
        lucide.createIcons();
    },

    /* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
    renderSidebar(list) {
        const container = document.getElementById('surah-list');
        container.innerHTML = list.map(s => `
            <div class="surah-item" id="si-${s.number}" onclick="App.loadSurah(${s.number}, this)">
                <div class="surah-num">${s.number}</div>
                <div class="surah-meta">
                    <div class="surah-name">${s.englishName}</div>
                    <div class="surah-sub">${s.revelationType} ¬∑ ${s.numberOfAyahs} Verses</div>
                </div>
                <div class="surah-ar">${s.name}</div>
            </div>
        `).join('');
        lucide.createIcons();
    },

    filter(q) {
        const filtered = this.surahs.filter(s =>
            s.englishName.toLowerCase().includes(q.toLowerCase()) ||
            s.englishNameTranslation.toLowerCase().includes(q.toLowerCase())
        );
        this.renderSidebar(filtered);
    },

    /* ‚îÄ‚îÄ TABS ‚îÄ‚îÄ */
    switchTab(tab) {
        ['surahs', 'bookmarks', 'stats'].forEach(t => {
            const panel = document.getElementById(`${t}-panel`);
            const btn = document.getElementById(`tab-${t}`);
            if (panel) panel.style.display = t === tab ? '' : 'none';
            if (btn) btn.classList.toggle('active', t === tab);
        });
        if (tab === 'bookmarks') this.renderBookmarksPanel();
        if (tab === 'stats') this.updateStats();
        document.getElementById('bookmarks-panel').classList.toggle('visible', tab === 'bookmarks');
    },

    /* ‚îÄ‚îÄ LOAD SURAH ‚îÄ‚îÄ */
    async loadSurah(num, el, scrollToAyah = null) {
        // Sidebar highlight
        document.querySelectorAll('.surah-item').forEach(i => i.classList.remove('active'));
        const target = el || document.getElementById(`si-${num}`);
        if (target) { target.classList.add('active'); target.scrollIntoView({ block: 'nearest' }); }

        // Save last read
        this.lastRead = { num, name: this.surahs[num-1]?.englishName || '' };
        localStorage.setItem('zp_lastread', JSON.stringify(this.lastRead));
        this.renderLastRead();

        // Track stat
        if (!this.stats.surahs.includes(num)) this.stats.surahs.push(num);
        this.saveStats();

        // Loading screen
        document.getElementById('view').innerHTML = `
            <div class="content-container">
                ${Array(5).fill(0).map(() => `<div class="ayah-card skeleton" style="height:180px;opacity:0.5;margin-bottom:20px"></div>`).join('')}
            </div>`;

        try {
            const [arRes, enRes] = await Promise.all([
                fetch(`https://api.alquran.cloud/v1/surah/${num}/quran-uthmani`).then(r => r.json()),
                fetch(`https://api.alquran.cloud/v1/surah/${num}/en.sahih`).then(r => r.json()),
            ]);
            const arAyahs = arRes.data.ayahs;
            const enAyahs = enRes.data.ayahs;
            this.currentSurah = arRes.data;
            this.currentAyahs = arAyahs.map((a, i) => ({ ...a, enText: enAyahs[i].text }));
            this.currentAyahIdx = -1;

            const hasBismillah = num !== 1 && num !== 9;

            let html = `<div class="content-container fade-in">
                <div class="surah-header">
                    <div class="sh-ar">${arRes.data.name}</div>
                    <div class="sh-en">${arRes.data.englishName} ¬∑ ${arRes.data.englishNameTranslation}</div>
                    <div class="sh-badges">
                        <span class="badge badge-blue">${arRes.data.revelationType}</span>
                        <span class="badge badge-gold">${arRes.data.numberOfAyahs} Verses</span>
                    </div>
                </div>
                ${hasBismillah ? `<div class="bismillah">ÿ®Ÿêÿ≥€°ŸÖŸê Ÿ±ŸÑŸÑŸéŸëŸáŸê Ÿ±ŸÑÿ±ŸéŸëÿ≠€°ŸÖŸéŸ∞ŸÜŸê Ÿ±ŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖŸê</div>` : ''}`;

            arAyahs.forEach((ayah, i) => {
                const bm = this.isBookmarked(num, ayah.numberInSurah);
                html += `
                <div class="ayah-card" id="ayah-card-${i}" style="animation-delay:${Math.min(i * 0.04, 0.6)}s">
                    <div class="ayah-top">
                        <span class="ayah-num-badge">AYAH ${ayah.numberInSurah}</span>
                        <div class="ayah-actions">
                            <button class="action-btn ${bm ? 'bookmarked-btn' : ''}" id="bm-btn-${i}" title="Bookmark"
                                onclick="App.toggleBookmark(${num}, ${ayah.numberInSurah}, '${arAyahs[i].text.substring(0,20).replace(/'/g,"\\'")}...', ${i})">
                                <i data-lucide="${bm ? 'bookmark-check' : 'bookmark'}" style="width:13px;height:13px"></i>
                            </button>
                            <button class="action-btn" title="Copy" onclick="App.copyAyah(${i})">
                                <i data-lucide="copy" style="width:13px;height:13px"></i>
                            </button>
                        </div>
                    </div>
                    <p class="ar">${ayah.text}</p>
                    <p class="en">${enAyahs[i].text}</p>
                    <div class="ayah-footer">
                        <button class="btn-mini" id="play-btn-${i}" onclick="App.playAyahByIdx(${i})">
                            <i data-lucide="play" style="width:11px;height:11px"></i> Play
                        </button>
                        <button class="btn-mini" onclick="App.toggleTafsir(${i}, ${ayah.number})">
                            <i data-lucide="book-open" style="width:11px;height:11px"></i> Tafsir
                        </button>
                        <button class="btn-mini" onclick="App.sharePage(${i})">
                            <i data-lucide="share-2" style="width:11px;height:11px"></i> Share
                        </button>
                    </div>
                    <div class="tafsir-box" id="tafsir-${i}"></div>
                </div>`;
            });

            html += `<div class="surah-divider">END OF SURAH</div></div>`;
            document.getElementById('view').innerHTML = html;
            document.getElementById('scroller').scrollTop = 0;
            if (scrollToAyah !== null) {
                setTimeout(() => {
                    const card = document.getElementById(`ayah-card-${scrollToAyah}`);
                    if (card) card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 300);
            }
            lucide.createIcons();
        } catch (e) {
            console.error(e);
            document.getElementById('view').innerHTML = `<div style="padding:60px;text-align:center;color:var(--text-dim)">Failed to load Surah. Check your connection.</div>`;
        }
    },

    /* ‚îÄ‚îÄ AUDIO ‚îÄ‚îÄ */
    playAyahByIdx(idx) {
        if (!this.currentAyahs.length) return;
        const ayah = this.currentAyahs[idx];
        this.currentAyahIdx = idx;
        this.playAyah(ayah.number, ayah.numberInSurah, idx);
    },

    playAyah(globalNum, localNum, idx = -1) {
        this.audio.src = `https://cdn.islamic.network/quran/audio/128/ar.alafasy/${globalNum}.mp3`;
        this.audio.playbackRate = SPEEDS[this.speedIdx];
        this.audio.play();
        document.getElementById('now-playing').innerText = `${this.currentSurah?.englishName || 'SURAH'} ¬∑ AYAH ${localNum}`;
        document.getElementById('hud-artwork').textContent = localNum;
        this.updatePlayIcon(true);
        document.getElementById('waveform').classList.add('active');

        // Card highlight
        document.querySelectorAll('.ayah-card').forEach(c => c.classList.remove('playing'));
        if (idx >= 0) {
            const card = document.getElementById(`ayah-card-${idx}`);
            if (card) {
                card.classList.add('playing');
                card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
            this.currentAyahIdx = idx;
        }

        // Update play buttons
        document.querySelectorAll('[id^="play-btn-"]').forEach(b => {
            b.innerHTML = `<i data-lucide="play" style="width:11px;height:11px"></i> Play`;
            b.classList.remove('active');
        });
        if (idx >= 0) {
            const pb = document.getElementById(`play-btn-${idx}`);
            if (pb) { pb.innerHTML = `<i data-lucide="pause" style="width:11px;height:11px"></i> Playing`; pb.classList.add('active'); }
        }
        lucide.createIcons();

        // Stats
        this.stats.listened = (this.stats.listened || 0) + 1;
        this.saveStats();
    },

    initAudioListeners() {
        const masterPlay = document.getElementById('masterPlay');
        masterPlay.onclick = () => {
            if (this.audio.paused) { this.audio.play(); this.updatePlayIcon(true); document.getElementById('waveform').classList.add('active'); }
            else { this.audio.pause(); this.updatePlayIcon(false); document.getElementById('waveform').classList.remove('active'); }
        };

        this.audio.ontimeupdate = () => {
            const p = (this.audio.currentTime / this.audio.duration) * 100 || 0;
            document.getElementById('p-bar').style.width = p + '%';
            const fmt = s => `${Math.floor(s/60)}:${Math.floor(s%60).toString().padStart(2,'0')}`;
            document.getElementById('time-display').innerText = `${fmt(this.audio.currentTime)} / ${fmt(this.audio.duration || 0)}`;
        };

        this.audio.onended = () => {
            document.getElementById('waveform').classList.remove('active');
            if (this.repeat) {
                this.audio.currentTime = 0;
                this.audio.play();
                return;
            }
            if (this.autoplay && this.currentAyahIdx >= 0 && this.currentAyahs.length) {
                const next = this.currentAyahIdx + 1;
                if (next < this.currentAyahs.length) {
                    this.playAyahByIdx(next);
                } else {
                    this.toast('üéâ Surah complete!');
                    this.updatePlayIcon(false);
                    document.querySelectorAll('.ayah-card').forEach(c => c.classList.remove('playing'));
                }
            } else {
                this.updatePlayIcon(false);
            }
        };

        this.audio.onpause = () => { document.getElementById('waveform').classList.remove('active'); };
        this.audio.onplay = () => { document.getElementById('waveform').classList.add('active'); };

        // Skip prev/next
        document.getElementById('btn-prev').onclick = () => {
            if (this.currentAyahIdx > 0) this.playAyahByIdx(this.currentAyahIdx - 1);
            else if (this.audio.currentTime > 3) { this.audio.currentTime = 0; }
        };
        document.getElementById('btn-next').onclick = () => {
            if (this.currentAyahIdx < this.currentAyahs.length - 1) this.playAyahByIdx(this.currentAyahIdx + 1);
        };

        // Repeat
        document.getElementById('btn-repeat').onclick = () => {
            this.repeat = !this.repeat;
            document.getElementById('btn-repeat').classList.toggle('active', this.repeat);
            this.toast(this.repeat ? 'üîÅ Repeat ON' : 'üîÅ Repeat OFF');
        };

        // Autoplay
        document.getElementById('btn-auto').onclick = () => {
            this.autoplay = !this.autoplay;
            document.getElementById('btn-auto').classList.toggle('active', this.autoplay);
            this.toast(this.autoplay ? '‚ñ∂ Auto-play ON' : '‚ñ∂ Auto-play OFF');
        };

        // Speed
        document.getElementById('speed-btn').onclick = () => {
            this.speedIdx = (this.speedIdx + 1) % SPEEDS.length;
            const s = SPEEDS[this.speedIdx];
            this.audio.playbackRate = s;
            document.getElementById('speed-btn').textContent = s + '√ó';
        };
    },

    initProgressBar() {
        const bg = document.getElementById('progress-bg');
        bg.addEventListener('click', e => {
            const rect = bg.getBoundingClientRect();
            const pct = (e.clientX - rect.left) / rect.width;
            if (this.audio.duration) this.audio.currentTime = pct * this.audio.duration;
        });
    },

    initVolume() {
        const slider = document.getElementById('vol-slider');
        slider.oninput = () => { this.audio.volume = slider.value; };
    },

    updatePlayIcon(playing) {
        const icon = document.querySelector('#masterPlay i');
        icon.setAttribute('data-lucide', playing ? 'pause' : 'play');
        lucide.createIcons();
    },

    /* ‚îÄ‚îÄ TAFSIR ‚îÄ‚îÄ */
    async toggleTafsir(idx, globalNum) {
        const box = document.getElementById(`tafsir-${idx}`);
        if (box.classList.contains('open')) { box.classList.remove('open'); return; }
        box.classList.add('open');
        if (box.dataset.loaded) return;
        box.innerHTML = `<div class="tafsir-loader"><div class="tafsir-spinner"></div> Loading commentary‚Ä¶</div>`;
        box.dataset.loaded = '1';
        try {
            if (!TAFSIR_CACHE[globalNum]) {
                const r = await fetch(`https://api.alquran.cloud/v1/ayah/${globalNum}/en.maududi`);
                const d = await r.json();
                TAFSIR_CACHE[globalNum] = d.data.text;
            }
            box.innerHTML = `<strong style="color:var(--accent);font-size:0.78rem;letter-spacing:0.06em">TAFSIR ¬∑ AL-MAUDUDI</strong><br><br>${TAFSIR_CACHE[globalNum]}`;
        } catch {
            box.innerHTML = `<em style="color:var(--text-dimmer)">Could not load tafsir. Check connection.</em>`;
        }
    },

    /* ‚îÄ‚îÄ BOOKMARKS ‚îÄ‚îÄ */
    isBookmarked(surahNum, ayahNum) {
        return this.bookmarks.some(b => b.surah === surahNum && b.ayah === ayahNum);
    },

    toggleBookmark(surahNum, ayahNum, preview, cardIdx) {
        const exists = this.bookmarks.findIndex(b => b.surah === surahNum && b.ayah === ayahNum);
        if (exists >= 0) {
            this.bookmarks.splice(exists, 1);
            this.toast('Bookmark removed');
        } else {
            this.bookmarks.push({ surah: surahNum, ayah: ayahNum, preview, name: this.currentSurah?.englishName || '' });
            this.toast('‚≠ê Bookmarked!');
        }
        localStorage.setItem('zp_bookmarks', JSON.stringify(this.bookmarks));
        // Update button
        const btn = document.getElementById(`bm-btn-${cardIdx}`);
        if (btn) {
            const isNowBm = exists < 0;
            btn.classList.toggle('bookmarked-btn', isNowBm);
            btn.innerHTML = `<i data-lucide="${isNowBm ? 'bookmark-check' : 'bookmark'}" style="width:13px;height:13px"></i>`;
            // Also update card
            document.getElementById(`ayah-card-${cardIdx}`).classList.toggle('bookmarked', isNowBm);
        }
        lucide.createIcons();
        this.updateStats();
    },

    renderBookmarksPanel() {
        const container = document.getElementById('bookmarks-list');
        if (!this.bookmarks.length) {
            container.innerHTML = `<div class="empty-state"><i data-lucide="bookmark" style="width:32px;height:32px;opacity:0.3;display:block;margin:0 auto 12px"></i>No bookmarks yet.<br>Tap the bookmark icon on any verse.</div>`;
            lucide.createIcons(); return;
        }
        container.innerHTML = this.bookmarks.map((b, i) => `
            <div class="bookmark-item" onclick="App.gotoBookmark(${b.surah}, ${b.ayah - 1})">
                <div>
                    <div class="bm-label">${b.name} ¬∑ Ayah ${b.ayah}</div>
                    <div class="bm-sub">${b.preview}</div>
                </div>
                <button class="bm-del" onclick="event.stopPropagation(); App.deleteBookmark(${i})" title="Delete">
                    <i data-lucide="x" style="width:13px;height:13px"></i>
                </button>
            </div>`).join('');
        lucide.createIcons();
    },

    deleteBookmark(i) {
        this.bookmarks.splice(i, 1);
        localStorage.setItem('zp_bookmarks', JSON.stringify(this.bookmarks));
        this.renderBookmarksPanel();
        this.updateStats();
    },

    gotoBookmark(surahNum, ayahIdx) {
        this.switchTab('surahs');
        this.loadSurah(surahNum, null, ayahIdx);
    },

    /* ‚îÄ‚îÄ COPY / SHARE ‚îÄ‚îÄ */
    copyAyah(idx) {
        if (!this.currentAyahs[idx]) return;
        const a = this.currentAyahs[idx];
        const text = `${a.text}\n\n"${a.enText}"\n\n‚Äî ${this.currentSurah?.englishName} ¬∑ Ayah ${a.numberInSurah}`;
        navigator.clipboard.writeText(text).then(() => this.toast('üìã Copied to clipboard!'));
    },

    sharePage(idx) {
        if (!this.currentAyahs[idx]) return;
        const a = this.currentAyahs[idx];
        const shareText = `"${a.enText}"\n‚Äî ${this.currentSurah?.englishName} ¬∑ Ayah ${a.numberInSurah} (Quran)`;
        if (navigator.share) {
            navigator.share({ text: shareText }).catch(() => {});
        } else {
            navigator.clipboard.writeText(shareText).then(() => this.toast('üìã Verse copied for sharing!'));
        }
    },

    /* ‚îÄ‚îÄ STATS & LAST READ ‚îÄ‚îÄ */
    saveStats() { localStorage.setItem('zp_stats', JSON.stringify(this.stats)); },
    updateStats() {
        document.getElementById('stat-listened').textContent = this.stats.listened || 0;
        document.getElementById('stat-bookmarks').textContent = this.bookmarks.length;
        document.getElementById('stat-surahs').textContent = (this.stats.surahs || []).length;
    },
    resetStats() {
        if (!confirm('Reset all stats?')) return;
        this.stats = { listened: 0, surahs: [] };
        this.saveStats();
        this.updateStats();
        this.toast('Stats reset');
    },

    renderLastRead() {
        const pill = document.getElementById('last-read-pill');
        const val = document.getElementById('last-read-val');
        if (this.lastRead) {
            pill.classList.add('visible');
            val.textContent = this.lastRead.name || `Surah ${this.lastRead.num}`;
        }
    },
    resumeLastRead() {
        if (this.lastRead) this.loadSurah(this.lastRead.num, null);
    },

    /* ‚îÄ‚îÄ KEYBOARD ‚îÄ‚îÄ */
    initKeyboard() {
        document.addEventListener('keydown', e => {
            if (e.target.tagName === 'INPUT') return;
            if (e.key === ' ') { e.preventDefault(); document.getElementById('masterPlay').click(); }
            else if (e.key === 'ArrowRight') { e.preventDefault(); document.getElementById('btn-next').click(); }
            else if (e.key === 'ArrowLeft') { e.preventDefault(); document.getElementById('btn-prev').click(); }
            else if (e.key === 'ArrowUp') { e.preventDefault(); this.audio.volume = Math.min(1, this.audio.volume + 0.1); document.getElementById('vol-slider').value = this.audio.volume; }
            else if (e.key === 'ArrowDown') { e.preventDefault(); this.audio.volume = Math.max(0, this.audio.volume - 0.1); document.getElementById('vol-slider').value = this.audio.volume; }
            else if (e.key.toLowerCase() === 'r') { document.getElementById('btn-repeat').click(); }
            else if (e.key.toLowerCase() === 'a') { document.getElementById('btn-auto').click(); }
            else if (e.key === '?') { document.getElementById('hotkeys-overlay').classList.add('open'); }
            else if (e.key === 'Escape') { document.getElementById('hotkeys-overlay').classList.remove('open'); }
        });
    },

    /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
    toast(msg) {
        const el = document.getElementById('toast');
        el.textContent = msg;
        el.classList.add('show');
        clearTimeout(this._toastT);
        this._toastT = setTimeout(() => el.classList.remove('show'), 2200);
    },
};

App.init();
</script>
</body>
</html>
