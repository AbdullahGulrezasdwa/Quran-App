<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zenith Quran Center</title>
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2855/2855160.png" type="image/png">
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=Amiri+Quran&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #020817; --card: #0f172a; --accent: #38bdf8; --border: rgba(255,255,255,0.08);
            --text: #f8fafc; --text-dim: #64748b; --sidebar-w: 260px; --rail-w: 80px;
        }
        body.emerald { --bg: #022c22; --card: #064e3b; --accent: #34d399; }
        body.royal { --bg: #1e1b4b; --card: #312e81; --accent: #a78bfa; }
        body.rose { --bg: #1c0a0d; --card: #2d1619; --accent: #fb7185; }

        * { box-sizing: border-box; margin: 0; padding: 0; border: none; outline: none; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); display: flex; height: 100dvh; transition: 0.3s; }

        /* SIDEBAR */
        nav { width: var(--sidebar-w); background: var(--card); border-right: 1px solid var(--border); display: flex; flex-direction: column; transition: 0.3s ease; flex-shrink: 0; z-index: 100; }
        nav.collapsed { width: var(--rail-w); }
        .nav-header { padding: 24px; display: flex; align-items: center; gap: 12px; border-bottom: 1px solid var(--border); }
        .logo { background: var(--accent); color: #000; width: 36px; height: 36px; border-radius: 10px; display: grid; place-items: center; font-weight: bold; }
        
        .nav-links { padding: 16px; flex: 1; display: flex; flex-direction: column; gap: 6px; }
        .nav-btn { display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 12px; cursor: pointer; color: var(--text-dim); background: transparent; transition: 0.2s; white-space: nowrap; font-size: 0.9rem; }
        .nav-btn:hover, .nav-btn.active { background: rgba(56, 189, 248, 0.1); color: var(--accent); }
        nav.collapsed .nav-btn span { opacity: 0; display: none; }

        /* MAIN CONTENT */
        main { flex: 1; overflow-y: auto; padding-bottom: 150px; scroll-behavior: smooth; }
        .container { max-width: 1000px; margin: 0 auto; padding: 40px; }

        /* HERO STATS */
        .hero-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .stat-card { background: var(--card); border: 1px solid var(--border); padding: 24px; border-radius: 20px; display: flex; align-items: center; gap: 15px; }
        
        /* SURAH GRID */
        .search-wrap { margin-bottom: 30px; position: relative; }
        .search-bar { width: 100%; background: var(--card); border: 1px solid var(--border); padding: 16px 20px 16px 50px; border-radius: 14px; color: white; font-size: 1rem; }
        .surah-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; }
        .surah-card { background: var(--card); border: 1px solid var(--border); padding: 20px; border-radius: 16px; cursor: pointer; transition: 0.3s; display: flex; justify-content: space-between; align-items: center; }
        .surah-card:hover { border-color: var(--accent); transform: translateY(-3px); background: rgba(255,255,255,0.02); }

        /* AYAH UI */
        .ayah-block { padding: 40px 0; border-bottom: 1px solid var(--border); position: relative; transition: 0.3s; }
        .ayah-block.playing { background: rgba(56, 189, 248, 0.03); padding-left: 20px; padding-right: 20px; border-radius: 15px; border-right: 4px solid var(--accent); }
        .ar { font-family: 'Amiri Quran'; font-size: 2.8rem; line-height: 2.2; text-align: right; margin-bottom: 15px; cursor: pointer; }
        .translit { color: var(--accent); font-size: 0.95rem; font-style: italic; margin-bottom: 10px; text-align: right; opacity: 0.8; letter-spacing: 0.5px; }
        .translation { color: var(--text-dim); line-height: 1.8; font-size: 1.1rem; }
        .tafsir-box { margin-top: 20px; padding: 20px; background: rgba(0,0,0,0.2); border-radius: 12px; font-size: 0.95rem; border: 1px solid var(--border); line-height: 1.6; display: none; }
        .tafsir-box.visible { display: block; border-left: 3px solid var(--accent); }

        /* PLAYER HUD */
        .hud { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 900px; background: rgba(15,23,42,0.9); backdrop-filter: blur(25px); border: 1px solid var(--border); border-radius: 24px; padding: 16px 32px; display: flex; align-items: center; gap: 20px; z-index: 1000; box-shadow: 0 20px 40px rgba(0,0,0,0.6); }
        .play-main { background: var(--accent); color: #000; width: 48px; height: 48px; border-radius: 50%; cursor: pointer; display: grid; place-items: center; flex-shrink: 0; transition: 0.2s; }
        .play-main:hover { transform: scale(1.1); }

        /* SETTINGS DRAWER */
        .drawer { position: fixed; right: 0; top: 0; height: 100%; width: 380px; background: var(--card); border-left: 1px solid var(--border); transform: translateX(100%); transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); z-index: 2000; padding: 40px; overflow-y: auto; }
        .drawer.open { transform: translateX(0); box-shadow: -20px 0 60px rgba(0,0,0,0.8); }
        .setting-group { margin-bottom: 30px; }
        .setting-group h4 { font-size: 0.75rem; color: var(--text-dim); text-transform: uppercase; margin-bottom: 15px; letter-spacing: 1px; }
        .toggle-btn { display: flex; justify-content: space-between; width: 100%; padding: 12px; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 10px; color: white; margin-bottom: 8px; cursor: pointer; }
        .toggle-btn.active { border-color: var(--accent); background: rgba(56, 189, 248, 0.1); }

        select { width: 100%; padding: 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 10px; color: white; cursor: pointer; }
    </style>
</head>
<body id="body">

<nav id="sidebar">
    <div class="nav-header">
        <div class="logo">Q</div>
        <span style="font-weight:700; font-size:1.1rem; letter-spacing: -0.5px">ZENITH PRO</span>
    </div>
    <div class="nav-links">
        <button class="nav-btn active" onclick="App.goHome()"><i data-lucide="layout-grid"></i><span>Dashboard</span></button>
        <button class="nav-btn" onclick="App.openBookmarks()"><i data-lucide="heart"></i><span>My Bookmarks</span></button>
        <button class="nav-btn" onclick="App.toggleDrawer('settings')"><i data-lucide="sliders"></i><span>Settings</span></button>
        <button class="nav-btn" onclick="App.export()"><i data-lucide="download"></i><span>Cloud Backup</span></button>
    </div>
</nav>

<div id="settings" class="drawer">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:40px">
        <h2>Settings</h2>
        <button onclick="App.toggleDrawer('settings')" style="background:none; color:white; cursor:pointer"><i data-lucide="x"></i></button>
    </div>

    <div class="setting-group">
        <h4>Reciter (Voice)</h4>
        <select id="reciter-id" onchange="App.updateReciter()">
            <option value="ar.alafasy">Mishary Rashid Alafasy</option>
            <option value="ar.husary">Mahmoud Khalil Al-Husary</option>
            <option value="ar.minshawi">Mohamed Siddiq El-Minshawi</option>
            <option value="ar.abdulsamad">Abdul Basit Abdul Samad</option>
            <option value="ar.abdurrahmaansudais">Abdurrahman As-Sudais</option>
        </select>
    </div>

    <div class="setting-group">
        <h4>Display Options</h4>
        <button class="toggle-btn active" id="btn-tr" onclick="App.toggleUI('tr')">Transliteration <span>ON</span></button>
        <button class="toggle-btn active" id="btn-en" onclick="App.toggleUI('en')">Translation <span>ON</span></button>
        <button class="toggle-btn" id="btn-tf" onclick="App.toggleUI('tf')">Tafsir (Explanation) <span>OFF</span></button>
    </div>

    <div class="setting-group">
        <h4>Interface Theme</h4>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px">
            <button class="nav-btn" style="border:1px solid var(--border)" onclick="App.setTheme('')">Midnight</button>
            <button class="nav-btn" style="border:1px solid var(--border)" onclick="App.setTheme('emerald')">Emerald</button>
            <button class="nav-btn" style="border:1px solid var(--border)" onclick="App.setTheme('royal')">Royal</button>
            <button class="nav-btn" style="border:1px solid var(--border)" onclick="App.setTheme('rose')">Rose</button>
        </div>
    </div>
</div>

<main id="scroller">
    <div class="container" id="view"></div>
</main>

<div class="hud">
    <button class="play-main" onclick="App.togglePlay()"><i data-lucide="play" id="p-icon"></i></button>
    <div style="flex:1">
        <div style="display:flex; justify-content:space-between; font-size:0.75rem; color:var(--text-dim); margin-bottom:10px">
            <span id="p-meta" style="font-weight:600; color:var(--accent)">READY TO RECITE</span>
            <span id="p-time">00:00 / 00:00</span>
        </div>
        <div style="height:6px; background:rgba(255,255,255,0.05); border-radius:10px; overflow:hidden">
            <div id="fill" style="height:100%; width:0%; background:var(--accent); transition:0.2s linear"></div>
        </div>
    </div>
</div>

<audio id="audio"></audio>

<script>
const App = (() => {
    let state = {
        surahs: [], current: null, activeAyah: null,
        favs: JSON.parse(localStorage.getItem('zen_favs') || '[]'),
        ui: { tr: true, en: true, tf: false },
        reciter: 'ar.alafasy'
    };
    const audio = document.getElementById('audio');

    const init = async () => {
        const res = await fetch('https://api.alquran.cloud/v1/surah');
        const d = await res.json();
        state.surahs = d.data;
        goHome();
        lucide.createIcons();
        
        audio.ontimeupdate = () => {
            const p = (audio.currentTime / audio.duration) * 100;
            document.getElementById('fill').style.width = p + '%';
            document.getElementById('p-time').innerText = `${fmtTime(audio.currentTime)} / ${fmtTime(audio.duration || 0)}`;
        };
        audio.onended = () => App.nextAyah();
    };

    const fmtTime = (s) => Math.floor(s/60) + ":" + Math.floor(s%60).toString().padStart(2,'0');

    const goHome = () => {
        document.getElementById('view').innerHTML = `
            <div class="hero-row">
                <div class="stat-card">
                    <div style="color:var(--accent)"><i data-lucide="zap"></i></div>
                    <div><h4 style="font-size:0.7rem; color:var(--text-dim)">STREAK</h4><p>7 Days Strong</p></div>
                </div>
                <div class="stat-card">
                    <div style="color:var(--accent)"><i data-lucide="target"></i></div>
                    <div><h4 style="font-size:0.7rem; color:var(--text-dim)">DAILY GOAL</h4><p>12 / 20 Ayahs</p></div>
                </div>
            </div>
            <div class="search-wrap">
                <i data-lucide="search" style="position:absolute; left:20px; top:18px; color:var(--text-dim)"></i>
                <input type="text" class="search-bar" placeholder="Search Surah by name or number..." oninput="App.filter(this.value)">
            </div>
            <div class="surah-grid" id="s-grid">${state.surahs.map(s => `
                <div class="surah-card" onclick="App.openSurah(${s.number})">
                    <div>
                        <span style="font-size:0.7rem; font-weight:800; color:var(--accent)">#${s.number}</span>
                        <h3 style="margin-top:4px; font-size:1rem">${s.englishName}</h3>
                    </div>
                    <div style="font-family:'Amiri Quran'; font-size:1.8rem; color:var(--accent)">${s.name}</div>
                </div>
            `).join('')}</div>
        `;
        lucide.createIcons();
    };

    return {
        init, goHome,
        toggleDrawer: (id) => document.getElementById(id).classList.toggle('open'),
        setTheme: (t) => document.getElementById('body').className = t,
        updateReciter: () => state.reciter = document.getElementById('reciter-id').value,
        toggleUI: (key) => {
            state.ui[key] = !state.ui[key];
            const btn = document.getElementById('btn-'+key);
            btn.classList.toggle('active');
            btn.querySelector('span').innerText = state.ui[key] ? 'ON' : 'OFF';
            if(state.current) App.openSurah(state.current.number);
        },
        openSurah: async (id) => {
            const [ar, en, tr] = await Promise.all([
                fetch(`https://api.alquran.cloud/v1/surah/${id}/quran-uthmani`).then(r => r.json()),
                fetch(`https://api.alquran.cloud/v1/surah/${id}/en.sahih`).then(r => r.json()),
                fetch(`https://api.alquran.cloud/v1/surah/${id}/en.transliteration`).then(r => r.json())
            ]);
            state.current = ar.data;
            let html = `<div style="text-align:center; padding:40px 0 80px">
                <h1 style="font-family:'Amiri Quran'; font-size:5.5rem; color:var(--accent)">${ar.data.name}</h1>
                <p style="letter-spacing:4px; color:var(--text-dim)">${ar.data.englishNameTranslation.toUpperCase()}</p>
            </div>`;
            
            ar.data.ayahs.forEach((v, i) => {
                const isFav = state.favs.includes(`${id}:${i+1}`);
                html += `
                <div class="ayah-block" id="ayah-${i}">
                    <p class="ar" onclick="App.playAyah(${i})">${v.text}</p>
                    ${state.ui.tr ? `<p class="translit">${tr.data.ayahs[i].text}</p>` : ''}
                    ${state.ui.en ? `<p class="translation">${en.data.ayahs[i].text}</p>` : ''}
                    <div class="tafsir-box ${state.ui.tf?'visible':''}">
                        <strong>Reflection:</strong> This verse from ${ar.data.englishName} teaches us about the importance of mindfulness and the vastness of creation.
                    </div>
                    <div style="margin-top:20px; display:flex; gap:10px">
                        <button onclick="App.toggleFav('${id}:${i+1}')" style="background:none; color:white; cursor:pointer"><i data-lucide="heart" style="${isFav?'fill:var(--accent); color:var(--accent)':''}"></i></button>
                        <button onclick="App.playAyah(${i})" style="background:none; color:white; cursor:pointer"><i data-lucide="play-circle"></i></button>
                    </div>
                </div>`;
            });
            document.getElementById('view').innerHTML = html;
            document.getElementById('scroller').scrollTop = 0;
            lucide.createIcons();
        },
        playAyah: (idx) => {
            state.activeAyah = idx;
            const ayahData = state.current.ayahs[idx];
            audio.src = `https://cdn.islamic.network/quran/audio/128/${state.reciter}/${ayahData.number}.mp3`;
            audio.play();
            
            document.querySelectorAll('.ayah-block').forEach(b => b.classList.remove('playing'));
            const el = document.getElementById('ayah-'+idx);
            el.classList.add('playing');
            el.scrollIntoView({ behavior: 'smooth', block: 'center' });
            
            document.getElementById('p-meta').innerText = `${state.current.englishName.toUpperCase()} : VERSE ${idx+1}`;
            document.getElementById('p-icon').setAttribute('data-lucide', 'pause');
            lucide.createIcons();
        },
        nextAyah: () => {
            if(state.current && state.activeAyah < state.current.ayahs.length - 1) App.playAyah(state.activeAyah + 1);
        },
        togglePlay: () => {
            if(!audio.src) return;
            audio.paused ? audio.play() : audio.pause();
            document.getElementById('p-icon').setAttribute('data-lucide', audio.paused ? 'play' : 'pause');
            lucide.createIcons();
        },
        toggleFav: (key) => {
            state.favs.includes(key) ? state.favs = state.favs.filter(k => k !== key) : state.favs.push(key);
            localStorage.setItem('zen_favs', JSON.stringify(state.favs));
            App.openSurah(state.current.number);
        },
        openBookmarks: () => {
            document.getElementById('view').innerHTML = `
                <h2 style="margin-bottom:30px">My Bookmarks</h2>
                <div class="surah-grid">${state.favs.map(f => `
                    <div class="surah-card" onclick="App.openSurah(${f.split(':')[0]})">
                        <div><h3>Verse ${f}</h3></div>
                        <i data-lucide="chevron-right"></i>
                    </div>
                `).join('')}</div>
            `;
            lucide.createIcons();
        },
        filter: (q) => {
            const filtered = state.surahs.filter(s => s.englishName.toLowerCase().includes(q.toLowerCase()) || s.number == q);
            document.getElementById('s-grid').innerHTML = filtered.map(s => `
                <div class="surah-card" onclick="App.openSurah(${s.number})">
                    <div><span style="color:var(--accent)">#${s.number}</span><h3>${s.englishName}</h3></div>
                    <div style="font-family:'Amiri Quran'; font-size:1.8rem; color:var(--accent)">${s.name}</div>
                </div>`).join('');
        },
        export: () => {
            const blob = new Blob([JSON.stringify({bookmarks: state.favs, settings: state.ui})], {type: 'application/json'});
            const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = "Zenith_Backup.json"; a.click();
        }
    };
})();
App.init();
</script>
</body>
</html>
