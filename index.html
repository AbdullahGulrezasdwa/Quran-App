<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>The Quran — Tajweed Master</title>
<script src="https://unpkg.com/lucide@latest"></script>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;700&family=Amiri+Quran&display=swap" rel="stylesheet"/>
<style>
:root {
  --bg:#020b12;--bg2:#03111c;--glass:rgba(10,40,60,0.45);--glass2:rgba(5,25,40,0.7);
  --p:#38bdf8;--pd:rgba(56,189,248,0.12);--pb:rgba(56,189,248,0.15);--t:#e2eff8;
  --font-ar:'Amiri Quran',serif;
  /* Tajweed Colors */
  --taj-ghunnah: #34d399; /* Green */
  --taj-qalqalah: #38bdf8; /* Blue */
  --taj-madd: #fb7185;    /* Red/Pink */
  --taj-ikhfa: #fbbf24;   /* Orange/Yellow */
  --taj-silent: #64748b;  /* Gray */
}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--t);margin:0;overflow:hidden;display:flex;}

/* NAVIGATION */
.nav-rail{width:80px;border-right:1px solid var(--pb);display:flex;flex-direction:column;align-items:center;padding:25px 0;gap:20px;background:var(--glass2);backdrop-filter:blur(30px);z-index:1000;}
.btn{background:transparent;border:1px solid transparent;color:var(--t);opacity:0.6;cursor:pointer;padding:12px;border-radius:15px;transition:0.3s;}
.btn:hover, .btn.on{opacity:1;background:var(--pd);border-color:var(--p);color:var(--p);}

/* CONTENT */
main { flex:1; overflow-y:auto; padding:40px; scroll-behavior:smooth; }
.surah-header { text-align:center; padding:60px 0; border-bottom:1px solid var(--pb); margin-bottom:40px; }
.ayah-card { padding:40px; border-bottom:1px solid var(--pb); transition:0.3s; }
.ayah-card:hover { background:var(--pd); }

/* TAJWEED STYLING */
.arabic { font-family:var(--font-ar); font-size:3.2rem; direction:rtl; line-height:2.6; margin-bottom:20px; word-spacing: 8px; }
.taj-g { color: var(--taj-ghunnah); font-weight: bold; } /* Ghunnah */
.taj-q { color: var(--taj-qalqalah); font-weight: bold; } /* Qalqalah */
.taj-m { color: var(--taj-madd); font-weight: bold; }     /* Madd */
.taj-s { color: var(--taj-silent); opacity: 0.5; }        /* Silent */

/* LEGEND PANEL */
.legend-panel { position:fixed; bottom:110px; right:30px; background:var(--bg2); border:1px solid var(--pb); padding:20px; border-radius:20px; width:220px; box-shadow:0 10px 40px rgba(0,0,0,0.5); z-index:2000; display:none; }
.legend-panel.show { display:block; animation: slideUp 0.3s ease; }
.legend-item { display:flex; align-items:center; gap:10px; font-size:0.8rem; margin-bottom:10px; }
.dot { width:10px; height:10px; border-radius:50%; }

@keyframes slideUp { from { transform:translateY(20px); opacity:0; } to { transform:translateY(0); opacity:1; } }

/* PLAYER */
.player { position:fixed; bottom:30px; left:50%; transform:translateX(-50%); width:90%; max-width:500px; background:var(--glass2); backdrop-filter:blur(40px); border:1px solid var(--pb); border-radius:100px; padding:15px 25px; display:flex; align-items:center; gap:15px; z-index:3000; }
</style>
</head>
<body>

<nav class="nav-rail">
  <div style="font-family:var(--font-ar); font-size:2rem; color:var(--p); cursor:pointer" onclick="location.reload()">ق</div>
  <button class="btn" onclick="TajweedCore.loadSurah(1)"><i data-lucide="home"></i></button>
  <button class="btn" onclick="TajweedCore.toggleLegend()"><i data-lucide="info"></i></button>
  <div style="flex:1"></div>
  <button class="btn"><i data-lucide="settings"></i></button>
</nav>

<main id="scroller">
    <div id="content">
        <div class="surah-header">
            <h1 style="font-size:3.5rem; letter-spacing:-1px">Tajweed Mode</h1>
            <p style="opacity:0.5">Recite with the beauty of precision.</p>
            <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:10px; max-width:500px; margin:40px auto">
                <button class="btn" style="opacity:1; border:1px solid var(--pb)" onclick="TajweedCore.loadSurah(67)">Mulk</button>
                <button class="btn" style="opacity:1; border:1px solid var(--pb)" onclick="TajweedCore.loadSurah(18)">Kahf</button>
                <button class="btn" style="opacity:1; border:1px solid var(--pb)" onclick="TajweedCore.loadSurah(55)">Rahman</button>
            </div>
        </div>
    </div>
</main>

<div class="legend-panel" id="legend">
    <p style="font-weight:bold; font-size:0.7rem; opacity:0.5; margin-bottom:15px; letter-spacing:1px">TAJWEED GUIDE</p>
    <div class="legend-item"><div class="dot" style="background:var(--taj-madd)"></div> Prolongation (Madd)</div>
    <div class="legend-item"><div class="dot" style="background:var(--taj-ghunnah)"></div> Nasalization (Ghunnah)</div>
    <div class="legend-item"><div class="dot" style="background:var(--taj-qalqalah)"></div> Echo (Qalqalah)</div>
    <div class="legend-item"><div class="dot" style="background:var(--taj-silent)"></div> Silent / Unpronounced</div>
</div>

<div class="player">
    <button class="btn" style="padding:10px; opacity:1" onclick="TajweedCore.toggleAudio()"><i data-lucide="play" id="play-icon"></i></button>
    <div style="flex:1; font-size:0.8rem; font-weight:bold" id="p-title">Select a Verse</div>
</div>

<audio id="audio-engine"></audio>

<script>
const TajweedCore = (() => {
    const audio = document.getElementById('audio-engine');
    
    // Simplified Tajweed Parser for demonstration
    // In production, we'd use the "uthmani_tajweed" API endpoint from Quran Foundation
    const applyTajweed = (text) => {
        return text
            .replace(/([آأإؤئ])|([اى]?[ًٌٍ])|([و]?[اأى])|([ي]?[اأو])/g, '<span class="taj-m">$1$2$3$4</span>') // Madd
            .replace(/([نّمّ])/g, '<span class="taj-g">$1</span>') // Ghunnah (Noon/Meem Shaddah)
            .replace(/([دجبطق])(?=[ْ\s]|$)/g, '<span class="taj-q">$1</span>') // Qalqalah (Ends with Sukun)
            .replace(/([ا])(?=[\s]|$)/g, '<span class="taj-s">$1</span>'); // Silent Alif
    };

    const loadSurah = async (id) => {
        const res = await fetch(`https://api.alquran.cloud/v1/surah/${id}/quran-uthmani`);
        const d = await res.json();
        const enRes = await fetch(`https://api.alquran.cloud/v1/surah/${id}/en.sahih`);
        const enD = await enRes.json();

        let html = `<div class="surah-header"><h1 style="font-family:var(--font-ar); font-size:5rem; color:var(--p)">${d.data.name}</h1></div>`;
        
        d.data.ayahs.forEach((v, i) => {
            html += `
                <div class="ayah-card" onclick="TajweedCore.playVerse(${v.number}, '${d.data.englishName} ${i+1}')">
                    <div class="arabic">${applyTajweed(v.text)}</div>
                    <div style="opacity:0.7; font-size:1.1rem; line-height:1.6">${enD.data.ayahs[i].text}</div>
                </div>`;
        });
        document.getElementById('content').innerHTML = html;
        document.getElementById('scroller').scrollTop = 0;
    };

    return {
        loadSurah,
        toggleLegend: () => document.getElementById('legend').classList.toggle('show'),
        playVerse: (gid, title) => {
            audio.src = `https://cdn.islamic.network/quran/audio/128/ar.alafasy/${gid}.mp3`;
            audio.play();
            document.getElementById('p-title').innerText = title.toUpperCase();
            document.getElementById('play-icon').setAttribute('data-lucide', 'pause');
            lucide.createIcons();
        },
        toggleAudio: () => {
            if(audio.paused) audio.play(); else audio.pause();
        }
    };
})();
document.addEventListener('DOMContentLoaded', () => { lucide.createIcons(); });
</script>
</body>
</html>
