<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quran | Reader</title>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600&family=Amiri+Quran&family=Scheherazade+New&family=Lateef&display=swap" rel="stylesheet" />
  
  <style>
    :root {
      --bg: #010c09; --card: #021a14; --primary: #10b981; --text: #ecfdf5; --muted: #6ee7b7;
      --border: rgba(16, 185, 129, 0.1); --font-ar: 'Amiri Quran', serif; --ar-size: 3.2rem;
      --gold: #fbbf24; --transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
    }

    /* Theme Engine - 20 Variants */
    body.t-dark-gold { --bg: #0d0d0d; --card: #1a1a1a; --primary: #d4af37; --text: #f2f2f2; }
    body.t-midnight { --bg: #020617; --card: #0f172a; --primary: #38bdf8; --text: #f1f5f9; }
    body.t-rose { --bg: #1c0a0a; --card: #2d1616; --primary: #fb7185; --text: #fff1f2; }
    body.t-slate { --bg: #0f172a; --card: #1e293b; --primary: #94a3b8; --text: #f8fafc; }
    body.t-nord { --bg: #2e3440; --card: #3b4252; --primary: #88c0d0; --text: #eceff4; }
    body.t-forest { --bg: #064e3b; --card: #065f46; --primary: #34d399; --text: #ecfdf5; }
    body.t-coffee { --bg: #1c1917; --card: #292524; --primary: #d6d3d1; --text: #fafaf9; }
    body.t-purple { --bg: #1e1b4b; --card: #312e81; --primary: #818cf8; --text: #eef2ff; }
    body.t-blood { --bg: #450a0a; --card: #7f1d1d; --primary: #f87171; --text: #fef2f2; }
    body.t-cyber { --bg: #000000; --card: #000000; --primary: #00ff00; --text: #00ff00; --border: 1px solid #00ff00; }
    /* Light Themes */
    body.t-paper { --bg: #f9f7f1; --card: #ffffff; --primary: #704214; --text: #2c1e12; }
    body.t-soft-blue { --bg: #f0f9ff; --card: #ffffff; --primary: #0ea5e9; --text: #0c4a6e; }
    body.t-minimal { --bg: #ffffff; --card: #f8fafc; --primary: #000000; --text: #000000; }
    body.t-sakura { --bg: #fff1f2; --card: #ffffff; --primary: #f43f5e; --text: #4c0519; }
    body.t-desert { --bg: #fffbeb; --card: #fef3c7; --primary: #b45309; --text: #451a03; }
    body.t-matcha { --bg: #f0fdf4; --card: #dcfce7; --primary: #15803d; --text: #064e3b; }
    body.t-lavender { --bg: #f5f3ff; --card: #ede9fe; --primary: #6d28d9; --text: #2e1065; }
    body.t-cloud { --bg: #f8fafc; --card: #f1f5f9; --primary: #475569; --text: #0f172a; }
    body.t-peach { --bg: #fff7ed; --card: #ffedd5; --primary: #c2410c; --text: #431407; }
    body.t-mint { --bg: #f0fdfa; --card: #ccfbf1; --primary: #0d9488; --text: #134e4a; }

    body { margin: 0; font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); overflow: hidden; display: flex; height: 100vh; }
    
    /* Animations */
    .btn-ui { background: none; border: none; color: var(--text); cursor: pointer; padding: 12px; border-radius: 16px; transition: var(--transition); display: flex; align-items: center; justify-content: center; }
    .btn-ui:hover { background: var(--border); transform: scale(1.1); color: var(--primary); }
    .btn-ui:active { transform: scale(0.9); }

    .nav-rail { width: 80px; border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding: 20px 0; gap: 20px; background: var(--bg); }
    main { flex: 1; overflow-y: auto; scroll-behavior: smooth; -webkit-overflow-scrolling: touch; }
    .content-max { max-width: 900px; margin: 0 auto; padding: 60px 20px 350px 20px; }

    .arabic { font-family: var(--font-ar); font-size: var(--ar-size); direction: rtl; line-height: 2.2; text-align: right; }
    .ayah-row { padding: 40px 0; border-bottom: 1px solid var(--border); opacity: 0; transform: translateY(20px); transition: 0.6s ease forwards; }
    .ayah-row.visible { opacity: 1; transform: translateY(0); }

    .play-btn { width: 60px; height: 60px; border-radius: 50%; background: var(--primary); border: none; color: var(--bg); cursor: pointer; transition: var(--transition); display: flex; align-items: center; justify-content: center; }
    body.playing .play-btn { transform: scale(1.1) rotate(180deg); background: var(--gold); }
    
    #pause-icon { display: none; }
    body.playing #pause-icon { display: block; }
    body.playing #play-icon { display: none; }

    /* Settings Panel */
    .drawer { position: fixed; right: -450px; top: 0; width: 400px; height: 100%; background: var(--card); border-left: 1px solid var(--border); z-index: 2000; transition: 0.5s cubic-bezier(0.77, 0, 0.175, 1); padding: 40px; overflow-y: auto; }
    .drawer.open { right: 0; }
    .theme-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 15px; }
    .theme-chip { height: 40px; border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: 0.2s; }
    .theme-chip:hover { border-color: var(--primary); }
  </style>
</head>
<body>

  <div id="settings-panel" class="drawer">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px">
        <h3 style="margin:0">Preferences</h3>
        <button onclick="Sanctuary.toggleSettings()" class="btn-ui"><i data-lucide="x"></i></button>
    </div>
    
    <label>Arabic Font</label>
    <select onchange="Sanctuary.updateFont(this.value)" style="width:100%; padding:10px; background:var(--bg); color:white; margin:10px 0">
        <option value="'Amiri Quran'">Amiri (Classic)</option>
        <option value="'Scheherazade New'">Scheherazade (Clear)</option>
        <option value="'Lateef'">Lateef (Soft)</option>
    </select>

    <label>Font Size</label>
    <input type="range" min="2" max="5" step="0.2" value="3.2" oninput="Sanctuary.updateFontSize(this.value)" style="width:100%; margin:15px 0">

    <label>Global Themes (20)</label>
    <div class="theme-grid" id="theme-container"></div>
  </div>

  <nav class="nav-rail">
    <button class="btn-ui" onclick="Sanctuary.navigateHome()"><i data-lucide="home"></i></button>
    <button class="btn-ui" onclick="Sanctuary.toggleSettings()"><i data-lucide="settings"></i></button>
    <button class="btn-ui" onclick="Sanctuary.toggleHifz()"><i data-lucide="brain"></i></button>
  </nav>

  <main id="scroller">
    <div class="content-max" id="app-view"></div>
  </main>

  <div style="position:fixed; bottom:30px; left:50%; transform:translateX(-50%); width:90%; max-width:1000px; background:rgba(2,26,20,0.8); backdrop-filter:blur(20px); border-radius:32px; padding:20px 40px; display:flex; align-items:center; justify-content:space-between; z-index:1000; border:1px solid var(--border)">
    <div id="meta-box"><div id="p-surah" style="font-weight:600">Sanctuary</div><div id="p-ayah" style="font-size:0.8rem; opacity:0.5">Ready</div></div>
    <div style="display:flex; align-items:center; gap:30px">
        <button class="btn-ui" onclick="Sanctuary.stepVerse(-1)"><i data-lucide="skip-back"></i></button>
        <button class="play-btn" onclick="Sanctuary.toggleAudio()">
            <i data-lucide="play" id="play-icon" fill="currentColor"></i>
            <i data-lucide="pause" id="pause-icon" fill="currentColor"></i>
        </button>
        <button class="btn-ui" onclick="Sanctuary.stepVerse(1)"><i data-lucide="skip-forward"></i></button>
    </div>
    <div id="streak-box" style="text-align:right"><i data-lucide="flame" color="var(--gold)"></i> <span id="streak-val">0</span>d</div>
  </div>

  <audio id="core-audio"></audio>

  <script>
    const Sanctuary = {
      themes: ['dark-gold', 'midnight', 'rose', 'slate', 'nord', 'forest', 'coffee', 'purple', 'blood', 'cyber', 'paper', 'soft-blue', 'minimal', 'sakura', 'desert', 'matcha', 'lavender', 'cloud', 'peach', 'mint'],
      state: { curIdx: -1, arData: null, reciter: 'ar.alafasy' },

      init() {
        this.audio = document.getElementById('core-audio');
        this.audio.onended = () => this.stepVerse(1);
        this.renderThemeGrid();
        this.loadStreak();
        
        fetch('https://api.alquran.cloud/v1/surah').then(r => r.json()).then(d => {
            this.state.surahs = d.data;
            this.router();
        });
        window.onpopstate = () => this.router();
        lucide.createIcons();
      },

      renderThemeGrid() {
        const container = document.getElementById('theme-container');
        this.themes.forEach(t => {
            const div = document.createElement('div');
            div.className = `theme-chip t-${t}`;
            div.style.background = 'var(--primary)';
            div.onclick = () => {
                document.body.className = `t-${t}`;
                localStorage.setItem('theme', `t-${t}`);
            };
            container.appendChild(div);
        });
      },

      updateFont(f) { document.documentElement.style.setProperty('--font-ar', f); },
      updateFontSize(s) { document.documentElement.style.setProperty('--ar-size', s + 'rem'); },
      toggleSettings() { document.getElementById('settings-panel').classList.toggle('open'); },

      async loadSurah(id) {
        const [ar, en] = await Promise.all([
          fetch(`https://api.alquran.cloud/v1/surah/${id}/quran-uthmani`).then(r => r.json()),
          fetch(`https://api.alquran.cloud/v1/surah/${id}/en.sahih`).then(r => r.json())
        ]);
        this.state.arData = ar.data;
        this.renderVerses(ar.data, en.data);
      },

      renderVerses(ar, en) {
        const view = document.getElementById('app-view');
        document.getElementById('p-surah').innerText = ar.englishName;
        let html = `<h2 style="text-align:center; font-family:var(--font-ar); font-size:4rem">${ar.name}</h2>`;
        
        ar.ayahs.forEach((v, i) => {
          html += `
            <div class="ayah-row" id="v-${i}" onclick="Sanctuary.prepVerse(${v.number}, ${i})">
                <div style="font-size:0.7rem; opacity:0.4; margin-bottom:10px">VERSE ${i+1}</div>
                <div class="arabic">${v.text}</div>
                <div class="translation" style="margin-top:15px; opacity:0.6">${en.ayahs[i].text}</div>
            </div>`;
        });
        view.innerHTML = html;
        setTimeout(() => document.querySelectorAll('.ayah-row').forEach(r => r.classList.add('visible')), 100);
        lucide.createIcons();
      },

      prepVerse(gid, idx) {
        this.state.curIdx = idx;
        document.getElementById(`v-${idx}`).scrollIntoView({behavior:'smooth', block:'center'});
        this.audio.src = `https://cdn.islamic.network/quran/audio/128/${this.state.reciter}/${gid}.mp3`;
        this.audio.play();
        document.body.classList.add('playing');
        this.updateStreak();
      },

      toggleAudio() {
        this.audio.paused ? this.audio.play() : this.audio.pause();
        document.body.classList.toggle('playing', !this.audio.paused);
      },

      stepVerse(d) {
        const n = this.state.curIdx + d;
        if(this.state.arData?.ayahs[n]) this.prepVerse(this.state.arData.ayahs[n].number, n);
      },

      loadStreak() {
        const s = localStorage.getItem('streak') || 0;
        document.getElementById('streak-val').innerText = s;
      },

      updateStreak() {
        const today = new Date().toDateString();
        const last = localStorage.getItem('last_read');
        if (last !== today) {
            let s = parseInt(localStorage.getItem('streak') || 0) + 1;
            localStorage.setItem('streak', s);
            localStorage.setItem('last_read', today);
            document.getElementById('streak-val').innerText = s;
        }
      },

      navigateHome() { window.history.pushState({}, '', window.location.pathname); this.renderHome(); },
      navigateSurah(id) { window.history.pushState({}, '', `?s=${id}`); this.loadSurah(id); },
      renderHome() {
        const view = document.getElementById('app-view');
        view.innerHTML = `<h1>Library</h1><div style="display:grid; grid-template-columns:repeat(auto-fill,minmax(250px,1fr)); gap:20px">` + 
            this.state.surahs.map(s => `<div class="btn-ui" onclick="Sanctuary.navigateSurah(${s.number})" style="display:block; text-align:left; border:1px solid var(--border); padding:25px; border-radius:24px"><strong>${s.englishName}</strong></div>`).join('') + `</div>`;
        lucide.createIcons();
      },
      router() { const s = new URLSearchParams(window.location.search).get('s'); s ? this.loadSurah(s) : this.renderHome(); }
    };
    window.onload = () => Sanctuary.init();
  </script>
</body>
</html>
